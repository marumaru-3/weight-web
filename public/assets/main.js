const T={REQUIRED:"required",TOO_SHORT:"too_short"},se=(e,{root:t}={})=>{if(e.disabled)return{ok:!0};if(e.type==="radio")return ke(e,{root:t});if(e.type==="checkbox")return Ae(e);const n=(e.value??"").trim();return e.id==="password"?xe(n):e.tagName==="SELECT"?Ie(e):e.tagName==="INPUT"||e.tagName==="TEXTAREA"?qe(e,n):{ok:!0}},ke=(e,{root:t}={})=>{const n=t??e.form??document,o=Array.from(n.querySelectorAll(`input[type="radio"][name="${e.name}"]`));return o.length===0?e.required&&!e.checked?{ok:!1,code:T.REQUIRED}:{ok:!0}:o.some(i=>i.required)?o.some(i=>i.checked)?{ok:!0}:{ok:!1,code:T.REQUIRED}:{ok:!0}},Ae=e=>e.required&&!e.checked?{ok:!1,code:T.REQUIRED}:{ok:!0},xe=e=>e===""?{ok:!1,code:T.REQUIRED}:e.length<4?{ok:!1,code:T.TOO_SHORT,payload:{min:4}}:{ok:!0},Ie=e=>e.required&&(e.value===""||e.selectedIndex===-1)?{ok:!1,code:T.REQUIRED}:{ok:!0},qe=(e,t)=>e.required&&t===""?{ok:!1,code:T.REQUIRED}:{ok:!0},Te={required:e=>`${e}を入力してください`,too_short:(e,t)=>`${e}は${(t==null?void 0:t.min)??4}文字以上で入力してください`},Me=e=>{const t=e.querySelector(".label-title, .label-name"),n=(t==null?void 0:t.textContent.trim())??"";return n.includes("（")?n.substring(0,n.indexOf("（")):n},me=(e,t)=>{if(!e||!t)return;const n="validate-form__input";let o=null;if(e.classList&&e.classList.contains(n)&&(o=e),!o&&e.closest){const r=e.closest(`.${n}`);r&&(o=r)}if(!o&&e.querySelector){const r=e.querySelector(`.${n}`);r&&(o=r)}o||(o=e);const s=o.closest(".basic-info-form__box")||null,a=s.querySelector(".validate-text")||null;if(!a)return;const i=Me(s);if(t.ok)a.textContent="",o.classList.remove("no-text"),o.setAttribute("aria-invalid","false");else{const c=(Te[t.code]||(()=>""))(i,t.payload);a.textContent=c,o.classList.add("no-text"),o.setAttribute("aria-invalid","true")}},N=new WeakMap,Ce=(e=document)=>{if(N.has(e))return N.get(e);const t=s=>{let a=s.target.closest("input, select, textarea");if(!a){const r=s.target.closest("label");if(r){const c=r.getAttribute("for");a=c?e.querySelector(`#${c}`):r.querySelector("input, select, textarea")}}if(!a||!e.contains(a))return;const i=a.closest(".validate-form__input");i&&(i.classList.add("click"),a&&(a.tagName==="INPUT"||a.tagName==="TEXTAREA")&&i.classList.add("text-on"))},n=s=>{s.target.closest("input, select, textarea, .pwd-btn")||e.querySelectorAll(".validate-form__input.click").forEach(a=>{const i=a.querySelector("input, textarea, select");a.classList.remove("click"),i&&(i.tagName==="INPUT"||i.tagName==="TEXTAREA")&&(i.value??"").trim()===""&&a.classList.remove("text-on")})};e.addEventListener("click",t),document.addEventListener("click",n);const o=()=>{e.removeEventListener("click",t),document.removeEventListener("click",n),N.delete(e)};return N.set(e,o),o},F=e=>{if(!e)return;e.querySelectorAll(".validate-form__input").forEach(n=>{n.querySelectorAll("input, select, textarea").forEach(s=>{Re(s,n,e)})})},Re=(e,t,n)=>{if(e.disabled)return!0;const o=se(e,{root:n});return me(t,o),o.ok},le=new WeakSet,_=e=>{if(!e||le.has(e))return;le.add(e);const t=()=>B(e);t(),e.addEventListener("input",t),e.addEventListener("change",t),e.querySelectorAll(".next-btn, .prev-btn").forEach(n=>{n.addEventListener("click",()=>{requestAnimationFrame(t)})})},B=e=>{if(!e)return!1;const n=e.querySelector(".step.visible")||e,s=[...n.querySelectorAll("[required]")].every(i=>se(i,{root:n}).ok);return e.querySelectorAll(".submit-btn").forEach(i=>{s?i.classList.remove("disabled"):i.classList.add("disabled"),i.disabled=!s}),s},j=e=>{e&&Ce(e)},Y=new WeakMap,$=e=>{if(!e)return;Y.has(e)||Y.set(e,new WeakSet);const t=Y.get(e);e.addEventListener("click",n=>{var s;const o=(s=n.target)==null?void 0:s.closest("input, select, textarea");!o||!e.contains(o)||o.disabled||t.has(o)||(Be(o,e),t.add(o))})},Be=(e,t)=>{if(!e||e.disabled)return;const n=e.tagName==="SELECT",o=e.type==="radio"||e.type==="checkbox",s=n||o?"change":"input",a=()=>{const i=(t==null?void 0:t.querySelector(".step.visible"))??t??e.form??document,r=e.closest(".validate-form__input"),c=se(e,{root:i});me(r,c)};e.addEventListener(s,a)},Oe=()=>{const e=document.querySelector(".basic-info-form");_(e),e&&e.addEventListener("submit",t=>{t.preventDefault()})},Fe=Object.freeze(Object.defineProperty({__proto__:null,init:Oe},Symbol.toStringTag,{value:"Module"})),v=e=>{const t=e.replace(/^\/+/,"");return`${BASE_PATH}${t}`},je=e=>{const t=new Image;t.src=e},$e=async(e,t)=>{var n;console.log("通信エラー:",e);try{const o=(n=t==null?void 0:t.headers)==null?void 0:n.get("Content-Type");o&&o.includes("application/json")?(console.log("サーバーレスポンス:",await t.json()),alert(`モーダルの読み込みに失敗しました。
`+e.message)):console.log("サーバーレスポンス:",await t.text())}catch(o){console.error("エラー内容の解析中に失敗しました:",o)}},S=async(e,t="GET",n=null,o={})=>{const s=await fetch(e,{method:t,body:n,...o});try{if(!s.ok)throw new Error(`APIエラー: ${s.status}`);const a=s.headers.get("Content-Type");return a&&a.includes("application/json")?await s.json():await s.text()}catch(a){return await $e(a,s),{success:!1,message:"通信エラーが発生しました。"}}},fe=async e=>S(v(`/index.php?modal=${e}`)),Pe=async e=>S(v("/index.php?modal=login"),"POST",e),He=async e=>S(v("/index.php?modal=register"),"POST",e),Ne=async()=>S(v("/api/chart_data.php")),ae=e=>{const t=e.closest("[data-date]");return t?t.dataset.date:null};let U={};const ge=async e=>{const t=ae(e);if(!t)return null;if(U[t])return U[t];const n=await S(v(`/api/record_data.php?date=${t}`));return n&&n.date?(U[t]=n,U[t]):null},Ue=async e=>S(v("/index.php?modal=recordAdmin"),"POST",e),Ve=async e=>S(v("/index.php?modal=record"),"POST",e),We=async e=>S(v("/index.php?modal=recordDelete"),"POST",e),ze=async e=>S(v("/index.php?modal=recordReset"),"POST",e);let V=null;const Ge=async()=>{if(V)return V;const e=await S(v("/api/user_data.php"));return e&&e.username?(V=e,V):null},Qe=async e=>S(v("/index.php?modal=adminUser"),"POST",e),Ye=async e=>S(v("/index.php?modal=adminAccount"),"POST",e),Je=async e=>S(v("/index.php?modal=accountDelete"),"POST",e),Xe=()=>{document.querySelector(".account-delete")&&document.getElementById("acc-delete-btn").addEventListener("click",async n=>{n.preventDefault();const o=await Je();window.history.scrollRestoration="manual",window.location.reload(),o.success||alert(o.message)})},Ke=Object.freeze(Object.defineProperty({__proto__:null,init:Xe},Symbol.toStringTag,{value:"Module"})),de=new WeakSet,J=new WeakSet,ie=(e,t)=>{document.querySelectorAll(e).forEach(o=>{if(de.has(o))return;de.add(o);const s=r=>{const c=r.target;J.has(c)||r.isComposing===!0||t(c)},a=r=>{J.add(r.target)},i=r=>{const c=r.target;J.delete(c),t(c)};o.addEventListener("input",s),o.addEventListener("change",s),o.addEventListener("compositionstart",a),o.addEventListener("compositionend",i),o.addEventListener("compositioncancel",i)})},W=(e,t)=>{const n=e.value;if(t===n)return;const o=typeof e.selectionStart=="number"&&typeof e.selectionEnd=="number",s=o?e.selectionStart:null,a=o?e.selectionEnd:null,i=o&&s===n.length&&a===n.length;if(e.value=t,!o)return;if(i){e.selectionStart=e.selectionEnd=t.length;return}const r=t.length-n.length,c=Math.max(0,Math.min(t.length,(s??0)+r)),h=Math.max(0,Math.min(t.length,(a??0)+r));e.selectionStart=c,e.selectionEnd=h},re=e=>{ie(e,t=>{const n=t.value.replace(/[^a-zA-Z0-9 !"#$%&'()*+,-./:;<=>?@[\\\]^_`{|}~]/g,"");W(t,n)})},Ze=e=>{ie(e,t=>{const n=t.value.replace(/[^0-9]/g,"");W(t,n)})},R=e=>{ie(e,t=>{let n=t.value;n=n.replace(/[^0-9.]/g,"");const o=n.indexOf(".");o!==-1&&(n=n.slice(0,o+1)+n.slice(o+1).replace(/\./g,""));const s=parseFloat(n);if(!isNaN(s)&&s>999.9){W(t,"999.9");return}const[a="",i=""]=n.split("."),r=a.slice(0,3),c=i.slice(0,1);n=c!==""||n.includes(".")?`${r}.${c}`:r,W(t,n)})},et=async()=>{const e=document.getElementById("login-form");_(e),$(e),j(e),re("input[data-alphanumeric]"),Ze("input[data-numeric]"),e&&e.addEventListener("submit",async t=>{if(t.preventDefault(),F(e),!B(e)){console.log("バリデーションエラー： フォーム送信をキャンセル");return}const o=new FormData(e),s=await Pe(o),a=document.querySelector(".form-message");s.success?window.location.href=v("/home"):(a.classList.add("error"),a.innerHTML=`ログインに失敗しました。<br>${s.errorMessage}`,a.style.display="block")})},tt=Object.freeze(Object.defineProperty({__proto__:null,init:et},Symbol.toStringTag,{value:"Module"})),he=()=>{const e=document.getElementById("step1"),t=document.getElementById("step2");if(!e||!t)return;const n=document.querySelectorAll(".btn--go-to-step2, #btn--go-to-step2"),o=document.getElementById("btn--back-to-step1"),s=i=>{i.preventDefault(),nt(e,t)},a=i=>{i.preventDefault(),ot(e,t)};n.forEach(i=>i.addEventListener("click",s)),o.addEventListener("click",a)},nt=(e,t)=>{e.classList.add("hidden"),e.classList.remove("visible"),t.classList.add("visible"),t.classList.remove("hidden")},ot=(e,t)=>{t.classList.add("hidden"),t.classList.remove("visible"),e.classList.add("visible"),e.classList.remove("hidden")},st=()=>{he();const e=document.querySelectorAll(".notice-contents"),t=document.querySelectorAll(".notice-detail"),n=s=>{t.forEach(a=>{a.classList.toggle("visible",a.id===s),a.classList.toggle("hidden",a.id!==s)})};e.forEach(s=>{s.addEventListener("click",()=>{n(s.dataset.notice)})});const o=document.querySelector("#header__notifications span");o.dataset.icon="notifications"},at=Object.freeze(Object.defineProperty({__proto__:null,init:st},Symbol.toStringTag,{value:"Module"})),it=e=>{const t=document.querySelector(".modal-record-admin"),n=document.getElementById("record-form");if(j(n),$(n),R("input[data-weight-input]"),e){const o=e.date.replace(/-/g,"/");t.querySelector(".date__contents").textContent=o,t.querySelector("#recorded_at").value=o,t.querySelector("#weight").value=e.weight,t.querySelector("#memo").value=e.memo||""}_(n),document.addEventListener("input",_(n)),document.addEventListener("change",_(n)),n&&(n.addEventListener("submit",async s=>{if(s.preventDefault(),F(n),!B(n)){console.log("バリデーションエラー： フォーム送信をキャンセル");return}const i=new FormData(n),r=await Ue(i);window.history.scrollRestoration="manual",window.location.reload(),r.success||alert(r.message)}),document.getElementById("delete-btn").addEventListener("click",async s=>{s.preventDefault();const a=new FormData(n),i=await We(a);window.history.scrollRestoration="manual",window.location.reload(),i.success||alert(i.message)}))},rt=Object.freeze(Object.defineProperty({__proto__:null,init:it},Symbol.toStringTag,{value:"Module"})),ct=()=>{document.querySelector(".record-reset")&&document.getElementById("reset-btn").addEventListener("click",async n=>{n.preventDefault();const o=await ze();window.history.scrollRestoration="manual",window.location.reload(),o.success||alert(o.message)})},lt=Object.freeze(Object.defineProperty({__proto__:null,init:ct},Symbol.toStringTag,{value:"Module"})),dt=()=>{const e=document.getElementById("date-contents"),t=document.getElementById("date-prev"),n=document.getElementById("date-next"),o=document.getElementById("recorded_at");if(!e&&!o&&!t&&!n)return;const s={dateContents:e,inputRecordedAt:o,dateNextBtn:n},a=ut();let i={selectedDate:a,today:a};i=X(i,"init"),K(s,i),t&&t.addEventListener("click",()=>{i=X(i,"prev"),K(s,i)}),n&&n.addEventListener("click",()=>{i=X(i,"next"),K(s,i)})},ut=()=>{const e=new Date,n=new Intl.DateTimeFormat("ja-JP",{timeZone:"Asia/Tokyo",year:"numeric",month:"2-digit",day:"2-digit"}).formatToParts(e),o=n.find(i=>i.type==="year").value,s=n.find(i=>i.type==="month").value,a=n.find(i=>i.type==="day").value;return new Date(`${o}-${s}-${a}T00:00:00+09:00`)},mt=e=>{const t=a=>("0"+a).slice(-2),n=e.getFullYear().toString(),o=t(e.getMonth()+1).toString(),s=t(e.getDate()).toString();return`${n}/${o}/${s}`},X=(e,t)=>{let{today:n}=e;const o=new Date(e.selectedDate);t==="prev"?o.setDate(o.getDate()-1):t==="next"&&o.getTime()<n.getTime()&&o.setDate(o.getDate()+1);const s=mt(o),a=o.getTime()<n.getTime();return{selectedDate:o,today:n,display:s,canGoNext:a}},K=(e,t)=>{const{dateContents:n,inputRecordedAt:o,dateNextBtn:s}=e;n&&(n.textContent=t.display),o&&(o.value=t.display),s&&(s.disabled=!t.canGoNext)},ft=async()=>{const e=document.getElementById("record-form");dt(),j(e),$(e),R("input[data-weight-input]"),_(e),document.addEventListener("input",_(e)),document.addEventListener("change",_(e)),e&&e.addEventListener("submit",async t=>{if(t.preventDefault(),F(e),!B(e)){console.log("バリデーションエラー： フォーム送信をキャンセル");return}const o=new FormData(e),s=await Ve(o);window.history.scrollRestoration="manual",window.location.reload(),s.success||alert(s.message)})},gt=Object.freeze(Object.defineProperty({__proto__:null,init:ft},Symbol.toStringTag,{value:"Module"})),pe=()=>{const e=document.getElementById("birth-year"),t=document.getElementById("birth-month"),n=document.getElementById("birth-day");if(!e||!t||!n)return;if(e.options.length<=1){const a=new Date().getFullYear();for(let i=a;i>=a-100;i--){let r=document.createElement("option");r.value=String(i),r.textContent=String(i),e.appendChild(r)}}const o=a=>a!==""&&Number.isFinite(+a)?+a:null,s=()=>{const a=o(e.value),i=o(t.value),r=o(n.value),c=ht(a,i,r);pt({yearSelect:e,monthSelect:t,daySelect:n},c)};e.addEventListener("change",s),t.addEventListener("change",s),requestAnimationFrame(s)},ht=(e,t,n)=>{const o=e==null,s=e==null||t==null;let a=null;s||(a=new Date(e,t,0).getDate());let i=null;return n!=null&&a!=null&&(i=Math.min(n,a)),{monthDisabled:o,dayDisabled:s,maxDay:a,nextDayValue:i}},pt=({yearSelect:e,monthSelect:t,daySelect:n},o)=>{const{monthDisabled:s,dayDisabled:a,maxDay:i,nextDayValue:r}=o;for(t.disabled=s,n.disabled=a;n.options.length>1;)n.remove(1);if(i!=null)for(let c=1;c<=i;c++){const h=document.createElement("option");h.value=String(c),h.textContent=String(c),n.appendChild(h)}r!=null?(n.value=String(r),n.value!==String(r)&&i!=null&&(n.value=String(i))):n.value=""},yt=()=>{const e=document.getElementById("register-form");pe(),j(e),_(e),$(e),re("input[data-alphanumeric]"),R("input[data-height-input]"),R("input[data-weight-input]"),he(),e&&e.addEventListener("submit",async t=>{if(t.preventDefault(),F(e),!B(e)){console.log("バリデーションエラー： フォーム送信をキャンセル");return}const o=new FormData(e),s=await He(o),a=document.querySelector(".form-message");s.success?(sessionStorage.setItem("accountCreated","true"),window.location.href=v("/home")):(a.classList.add("error"),a.innerHTML=`新規登録に失敗しました。<br>${s.errorMessage}`,a.style.display="block")})},vt=Object.freeze(Object.defineProperty({__proto__:null,init:yt},Symbol.toStringTag,{value:"Module"})),bt=e=>{const t=document.querySelector("#user-info-form");pe(),j(t),$(t),re("input[data-alphanumeric]"),R("input[data-height-input]"),R("input[data-weight-input]");const n=document.querySelector(".admin-account-form"),o=document.querySelector(".admin-user-form"),s=document.querySelector(".modal");if(e){s.querySelector("#username").value=e.username,s.querySelector("#birth-year").value=e.birth_year,s.querySelector("#birth-month").value=e.birth_month,requestAnimationFrame(()=>{s.querySelector("#birth-day").value=e.birth_day});const a=document.querySelector(`input[name="gender"][value="${e.gender}`);a.checked=!0,s.querySelector("#height").value=e.height,s.querySelector("#ideal-weight").value=e.ideal_weight}_(t),document.addEventListener("input",_(t)),document.addEventListener("change",_(t)),t&&t.addEventListener("submit",async a=>{if(a.preventDefault(),F(t),!B(t)){console.log("バリデーションエラー： フォーム送信をキャンセル");return}const r=new FormData(t);let c;n&&(c=await Ye(r)),o&&(c=await Qe(r)),window.history.scrollRestoration="manual",window.location.reload(),c.success||alert(c.message)})},St=Object.freeze(Object.defineProperty({__proto__:null,init:bt},Symbol.toStringTag,{value:"Module"})),Et="visibility",_t="visibility_off",wt="パスワードを表示",Lt="パスワードを非表示",Dt=()=>{const e=document.querySelectorAll(".pwd-btn");e.length&&e.forEach(t=>{if(t.dataset.inited==="1")return;t.dataset.inited="1",be(t);const n=()=>kt(t);t.addEventListener("click",n)})},kt=e=>{const t=ye(e);t&&(At(e,!ve(e)),be(e,t))},ye=e=>{const t=e.previousElementSibling;return t&&t.tagName.toLowerCase()==="input"?t:null},At=(e,t)=>e.dataset.hidden=String(t),ve=e=>e.dataset.hidden==="true",be=(e,t=ye(e))=>{if(!t)return;const n=ve(e);xt(t,n),It(e,n),qt(e,t,n)},xt=(e,t)=>{e.type=t?"password":"text"},It=(e,t)=>{const n=e.querySelector("[data-icon]");n&&(n.dataset.icon=t?Et:_t)},qt=(e,t,n)=>{t.id&&e.setAttribute("aria-controls",t.id),e.setAttribute("aria-pressed",String(!n)),e.setAttribute("aria-label",Tt(n))},Tt=e=>e?wt:Lt,Se=document.querySelector("body"),Mt=document.getElementById("layout");let Z=!1;const ne=new Map,q=new Map,Ct=(e,t)=>{const n={record:"./init/record.js",recordAdmin:"./init/record-admin.js",recordReset:"./init/record-reset.js",adminAccount:"./init/user-info.js",adminUser:"./init/user-info.js",login:"./init/login.js",register:"./init/register.js",accountCreated:"./init/account-created.js",accountDelete:"./init/account-delete.js",notifications:"./init/notifications.js"},o=Object.assign({"./init/account-created.js":Fe,"./init/account-delete.js":Ke,"./init/login.js":tt,"./init/notifications.js":at,"./init/record-admin.js":rt,"./init/record-reset.js":lt,"./init/record.js":gt,"./init/register.js":vt,"./init/user-info.js":St}),s=n[e],a=o[s];s&&typeof a.init=="function"&&a.init(t)},ue=async(e,t=null)=>{const n=e;let o=e,s=null;if(e==="recordAdmin"&&t){const i=ae(t);if(!i)return;o=`recordAdmin-${i}`,q.has(o)||(s=await ge(t),q.set(o,s))}if(e==="adminUser"&&!q.has(o)&&(s=await Ge(),q.set(o,s)),e==="record"&&je("/images/date-arrow.svg"),ne.has(n))return;const a=await fe(e);ne.set(n,a)},ce=async(e,t=null)=>{if(Z)return;Z=!0;const n=ne.get(e)||await fe(e),o=t?q.get(t):null;Mt.insertAdjacentHTML("afterend",n),Se.style.overflow="hidden",Dt(),Ct(e,o),document.querySelectorAll(".close-modal").forEach(a=>{a&&a.addEventListener("click",Ee)}),Z=!1},Ee=()=>{const e=document.getElementById("modal");e&&(e.remove(),Se.style.overflow="")},_e=document.querySelectorAll("[data-modal]");_e.forEach(e=>{e.addEventListener("click",async()=>{const t=e.getAttribute("data-modal");let n=t;if(t==="recordAdmin"){const o=ae(e);o&&(n=`recordAdmin-${o}`)}if(!q.has(n)){const o=await ge(e);q.set(n,o)}ce(t,n)})});document.addEventListener("click",e=>{const t=document.querySelector("#modal.record, #modal.recordAdmin");t&&e.target===t&&Ee()});const we=new Set;_e.forEach(e=>{const t=e.getAttribute("data-modal");we.add(t)});const Rt=document.querySelectorAll('[data-modal="recordAdmin"]');window.addEventListener("load",()=>{setTimeout(async()=>{const e=[...we].map(t=>ue(t));await Promise.all(e);for(const t of Rt)await ue("recordAdmin",t)},1e3)});sessionStorage.getItem("accountCreated")==="true"&&(ce("accountCreated"),sessionStorage.removeItem("accountCreated"));showIdModal&&ce("idCheck");const Bt=()=>{const e=document.getElementById("header");if(!e)return;const t=e.offsetHeight;let n=0;window.addEventListener("load",()=>{window.addEventListener("scroll",()=>{const r=window.scrollY||document.documentElement.scrollTop;r>n&&r>t?e.style.top=`-${t}px`:e.style.top="0",n=r})});const o=document.getElementById("menu-toggle"),s=document.querySelector(".layout__sidebar");o.addEventListener("click",()=>{s.classList.contains("open")?(s.classList.remove("open"),s.classList.add("close")):(s.classList.remove("close"),s.classList.add("open"))});const a=window.matchMedia("(max-width: 1299px)"),i=r=>{r.matches?(s.classList.remove("open"),s.classList.add("close")):(s.classList.remove("close"),s.classList.add("open"))};i(a),a.addEventListener("change",i),document.addEventListener("click",r=>{r.target.closest(".layout__sidebar")||a.matches&&(s.classList.remove("open"),s.classList.add("close"))})},Ot=()=>{const e=document.querySelectorAll(".accordion-btn");e.length&&e.forEach((t,n)=>{Ft(t,n),t.addEventListener("click",()=>jt(t))})},Ft=(e,t)=>{const n=e.closest(".accordion"),o=n==null?void 0:n.querySelector(".accordion-content");if(!n||!o)return;const s=`accordion-btn-${t+1}`,a=`accordion-panel-${t+1}`;e.id=s,e.setAttribute("aria-controls",a),e.setAttribute("aria-expanded","false"),o.id=a,o.setAttribute("role","region"),o.setAttribute("aria-labelledby",s),o.hidden=!0,o.style.maxHeight="0",n.setAttribute("data-state","close")},jt=e=>{const t=e.closest(".accordion"),n=t==null?void 0:t.querySelector(".accordion-content");if(!t||!n)return;t.getAttribute("data-state")==="open"?Pt(t,e,n):$t(t,e,n)},$t=(e,t,n)=>{n.hidden=!1,n.style.maxHeight="0",requestAnimationFrame(()=>{n.style.maxHeight=n.scrollHeight+"px"}),t.setAttribute("aria-expanded","true"),e.setAttribute("data-state","open")},Pt=(e,t,n)=>{n.style.maxHeight=n.scrollHeight+"px",requestAnimationFrame(()=>{n.style.maxHeight="0"});const o=s=>{s.propertyName==="max-height"&&(n.hidden=!0,n.removeEventListener("transitionend",o))};n.addEventListener("transitionend",o),t.setAttribute("aria-expanded","false"),e.setAttribute("data-state","close")},Ht=()=>{const e=document.getElementById("header__info"),t=document.getElementById("header__profile"),n=document.getElementById("user-popup");!e||!t||!n||(Nt(t,n),t.addEventListener("click",o=>{o.stopPropagation(),Ut(e,t)}),document.addEventListener("click",o=>{n.contains(o.target)||Le(e,t)}))},Nt=(e,t)=>{e.setAttribute("aria-controls",t.id),e.setAttribute("aria-expanded","false")},Ut=(e,t)=>{e.classList.contains("click")?Le(e,t):Vt(e,t)},Vt=(e,t)=>{e.classList.add("click"),t.setAttribute("aria-expanded","true")},Le=(e,t)=>{e.classList.remove("click"),t.setAttribute("aria-expanded","false")},Wt="IDをコピーしました。",oe="copy-dialog",zt=10,Gt=1500,Qt=2e3,Yt=(e=document,{message:t=Wt}={})=>{const n=async o=>{const s=o.target.closest(".copy-link");if(!s)return;const a=s.closest(".copy-contents"),i=a==null?void 0:a.querySelector(".copy__value");if(i&&!document.querySelector(`.${oe}`))try{await navigator.clipboard.writeText(i.textContent),Jt(t)}catch{}};e.addEventListener("click",n)},Jt=e=>{const t=Xt();Kt(t,e)},Xt=()=>{let e=document.querySelector(`.${oe}`);return e||(e=document.createElement("div"),e.classList.add(oe),e.setAttribute("role","status"),e.setAttribute("aria-live","polite"),e.setAttribute("aria-atomic","true"),document.body.appendChild(e)),e},Kt=(e,t)=>{e.textContent=t,setTimeout(()=>e.classList.add("show"),zt),setTimeout(()=>e.classList.remove("show"),Gt),setTimeout(()=>e.remove(),Qt)},Zt=()=>{const e=document.querySelector(".weight-days__blocks"),t=document.querySelector(".weight-days .btn--more"),n=[...document.querySelectorAll(".weight-days__switch button")],o={parent:e,btnMore:t,switchBtns:n},s=[...document.querySelectorAll(".weight-days__block")];if(!e||!s.length)return;const a=s.map(c=>({el:c,dateStr:c.querySelector(".weight-days__date").textContent.trim()})),i={sort:"new",showNum:6};let r=ee(a,i);te(o,a,r),t.addEventListener("click",()=>{i.showNum+=6,r=ee(a,i),te(o,a,r)}),n.forEach(c=>{c.addEventListener("click",()=>{c.dataset.sort==="old"?i.sort="old":i.sort="new",r=ee(a,i),te(o,a,r)})})},ee=(e,t)=>{const{sort:n,showNum:o}=t,s=h=>e[h].dateStr.trim(),a=e.map((h,b)=>b).sort((h,b)=>n==="old"?s(h).localeCompare(s(b)):s(b).localeCompare(s(h))),i=Math.min(o,e.length),r=i<e.length;return{order:a,visibleCount:i,canShowMore:r,selectedSort:n}},te=(e,t,n)=>{const{parent:o,btnMore:s,switchBtns:a}=e,{order:i,visibleCount:r,canShowMore:c,selectedSort:h}=n;if(!o)return;const b=new DocumentFragment;i.forEach((l,P)=>{const O=t[l].el;P<r?O.classList.add("show"):O.classList.remove("show"),b.appendChild(O)}),o.innerHTML="",o.appendChild(b),c||s.classList.add("hide"),a&&a.length&&a.forEach(l=>{l.classList.toggle("btn--select",l.dataset.sort===h)})},en=async()=>{const e=document.getElementById("graph");if(!e)return;const t=await Ne(),n=t.chart_arr,o=t.ideal_weight;Chart.register(window["chartjs-plugin-annotation"]);const s=(d,f=!1)=>{const m=new Date;m.setHours(0,0,0,0);let w=new Date(m.setDate(m.getDate()+1)),L=new Date(m);const E={"7d":[7,14],"1m":[1,2],"3m":[3,6],"6m":[6,12],"1y":[12,24]};d==="7d"?(w.setDate(m.getDate()-(f?E[d][1]:E[d][0])),f&&L.setDate(m.getDate()-E[d][0])):(w.setMonth(m.getMonth()-(f?E[d][1]:E[d][0])),f&&L.setMonth(m.getMonth()-E[d][0]));let p=[],y=new Date(w);for(;y<L;)p.push(new Date(y.getTime()-y.getTimezoneOffset()*6e4).toISOString().split("T")[0]),y.setDate(y.getDate()+1);return p},a=(d,f=!1)=>{const m=s(d,f),w=Object.fromEntries(n.map(g=>[g.date,g.weight])),L=Object.fromEntries(n.map(g=>[g.date,g.bmi])),E=Object.fromEntries(n.map(g=>[g.date,g.bfp])),p=m.map(g=>w[g]??null),y=m.map(g=>L[g]??null),A=m.map(g=>E[g]??null);return{labels:m,dataset:p,bmi:y,bfp:A}},i=window.matchMedia("(max-width: 599px)");let r;const c=d=>{const{labels:f,dataset:m}=a(d),w=f.map(p=>p.replaceAll("-","/")),L=e.getContext("2d");r&&r.destroy(),r=new Chart(L,{type:"line",data:{labels:w,datasets:[{label:"体重（kg）",data:m,backgroundColor:"#4a90e2",borderColor:"#4a90e2",borderWidth:2,pointRadius:4,pointBackgroundColor:"#fff",pointBorderColor:"#4a90e2",pointBorderWidth:3,hoverBorderWidth:4,pointHoverRadius:6,spanGaps:!0}]},options:{responsive:!0,maintainAspectRatio:!0,aspectRatio:i.matches?4/3:2/1,scales:{x:{ticks:{autoSkip:!0,callback(p){return f[p]?`${new Date(f[p]).getDate()}日`:""},maxRotation:0,minRotation:0,maxTicksLimit:15}},y:{suggestedMax:Math.max(...m)+1,suggestedMin:o-1,ticks:{maxTicksLimit:i.matches?6:8}}},plugins:{legend:{display:!1},tooltip:{titleFont:{size:i.matches?10:12,family:"Inter, Noto Sans JP, sans-serif"},bodyFont:{size:i.matches?12:14,family:"Inter, Noto Sans JP, sans-serif"},callbacks:{label(p){return` 体重: ${p.raw} kg`}}},annotation:{annotations:{goalLine:{type:"line",yMin:o,yMax:o,borderColor:"#e65100",borderWidth:2,borderDash:[6,6],label:{content:"目標体重",enabled:!0,position:"end"}}}}}}});const E=p=>{const y=p,A=Math.ceil(f.length/y);let g=0;r.data.datasets[0].data=m.map((H,C,x)=>{const u=x.length-1,D=u-C;if(C===u||D%A===0){let z=m.slice(g,C+1).filter(Q=>Q),k=z.reduce((Q,De)=>parseFloat(Q)+parseFloat(De),0);if(!k)return null;let G=(k/z.length).toFixed(1);return g=C+1,G}else return null})};if(i.matches?(E(12),r.update()):(E(31),r.update()),d==="3m"||d==="6m"||d==="1y"){let p=null;r.options.scales.x.ticks.callback=y=>{let A=new Date(f[y]),g=A.getMonth()+1,H=A.getDate();if(!(g===p||H!==1))return p=g,`${g}月`},r.update()}},h=d=>{const f=s(d).map(L=>L.replaceAll("-","/")),m=f[0],w=f[f.length-1];return`${m}～${w}`},b=document.querySelector(".weight-graph__date");let l="1m";c(l),b.innerHTML=h(l),i.addEventListener("change",()=>c(l));const P=document.querySelectorAll(".weight-graph__switch button"),O=document.querySelectorAll(".weight-summary__block");if(P.length<1)return;P.forEach(d=>{d.addEventListener("click",()=>{var f;(f=document.querySelector(".weight-graph__switch .btn--select"))==null||f.classList.remove("btn--select"),d.classList.add("btn--select")})});const M=d=>{const f=a(d),m=f.dataset.filter(u=>u!==null),w=f.bmi.filter(u=>u!==null),L=f.bfp.filter(u=>u!==null),p=a(d,!0).dataset.filter(u=>u!==null),y=(u,D=1)=>{const I=u.filter(k=>k!=null).map(k=>parseFloat(k.replace(/,/g,"")));return I.length?(I.reduce((k,G)=>k+G,0)/I.length).toFixed(D):null},A=(u,D)=>{if(u.length&&D.length){const I=(y(u)-y(D)).toFixed(1);return I>0?"+"+I:String(I)}else return null},g=u=>u.length?Math.max(...u).toFixed(1):null,H=u=>u.length?Math.min(...u).toFixed(1):null,C={average:y(m),bfp:y(L,2),bmi:y(w,2),in_de:A(m,p),best:g(m),lowest:H(m)};let x;d==="7d"&&(x="1週間"),d==="1m"&&(x="1ヶ月"),d==="3m"&&(x="3ヶ月"),d==="6m"&&(x="半年"),d==="1y"&&(x="1年"),O.forEach(u=>{u.querySelector(".period").innerHTML=x;const D=C[u.dataset.summary];D?u.querySelector(".weight-summary__num").innerHTML=D:u.querySelector(".weight-summary__num").innerHTML="--"})};M(l),document.getElementById("weight-graph__week").addEventListener("click",()=>{l="7d",c(l),b.innerHTML=h(l),M(l)}),document.getElementById("weight-graph__month").addEventListener("click",()=>{l="1m",c(l),b.innerHTML=h(l),M(l)}),document.getElementById("weight-graph__three-month").addEventListener("click",()=>{l="3m",c(l),b.innerHTML=h(l),M(l)}),document.getElementById("weight-graph__half-year").addEventListener("click",()=>{l="6m",c(l),b.innerHTML=h(l),M(l)}),document.getElementById("weight-graph__year").addEventListener("click",()=>{l="1y",c(l),b.innerHTML=h(l),M(l)})};document.querySelector("#header")&&Bt();document.querySelector(".accordion")&&Ot();document.querySelector("#header__info")&&Ht();Yt();document.querySelector(".weight-days__blocks")&&Zt();document.querySelector("#graph")&&en();
