const w={REQUIRED:"required",TOO_SHORT:"too_short"},G=(t,{root:e}={})=>{if(t.disabled)return{ok:!0};if(t.type==="radio")return pt(t,{root:e});if(t.type==="checkbox")return yt(t);const n=(t.value??"").trim();return t.id==="password"?vt(n):t.tagName==="SELECT"?bt(t):t.tagName==="INPUT"||t.tagName==="TEXTAREA"?St(t,n):{ok:!0}},pt=(t,{root:e}={})=>{const n=e??t.form??document,o=Array.from(n.querySelectorAll(`input[type="radio"][name="${t.name}"]`));return o.length===0?t.required&&!t.checked?{ok:!1,code:w.REQUIRED}:{ok:!0}:o.some(r=>r.required)?o.some(r=>r.checked)?{ok:!0}:{ok:!1,code:w.REQUIRED}:{ok:!0}},yt=t=>t.required&&!t.checked?{ok:!1,code:w.REQUIRED}:{ok:!0},vt=t=>t===""?{ok:!1,code:w.REQUIRED}:t.length<4?{ok:!1,code:w.TOO_SHORT,payload:{min:4}}:{ok:!0},bt=t=>t.required&&(t.value===""||t.selectedIndex===-1)?{ok:!1,code:w.REQUIRED}:{ok:!0},St=(t,e)=>t.required&&e===""?{ok:!1,code:w.REQUIRED}:{ok:!0},Et={required:t=>`${t}を入力してください`,too_short:(t,e)=>`${t}は${(e==null?void 0:e.min)??4}文字以上で入力してください`},_t=t=>{const e=t.querySelector(".label-title, .label-name"),n=(e==null?void 0:e.textContent.trim())??"";return n.includes("（")?n.substring(0,n.indexOf("（")):n},nt=(t,e)=>{if(!t||!e)return;const n="validate-form__input";let o=null;if(t.classList&&t.classList.contains(n)&&(o=t),!o&&t.closest){const i=t.closest(`.${n}`);i&&(o=i)}if(!o&&t.querySelector){const i=t.querySelector(`.${n}`);i&&(o=i)}o||(o=t);const s=o.closest(".basic-info-form__box")||null,a=s.querySelector(".validate-text")||null;if(!a)return;const r=_t(s);if(e.ok)a.textContent="",o.classList.remove("no-text"),o.setAttribute("aria-invalid","false");else{const c=(Et[e.code]||(()=>""))(r,e.payload);a.textContent=c,o.classList.add("no-text"),o.setAttribute("aria-invalid","true")}},T=new WeakMap,wt=(t=document)=>{if(T.has(t))return T.get(t);const e=s=>{let a=s.target.closest("input, select, textarea");if(!a){const i=s.target.closest("label");if(i){const c=i.getAttribute("for");a=c?t.querySelector(`#${c}`):i.querySelector("input, select, textarea")}}if(!a||!t.contains(a))return;const r=a.closest(".validate-form__input");r&&(r.classList.add("click"),a&&(a.tagName==="INPUT"||a.tagName==="TEXTAREA")&&r.classList.add("text-on"))},n=s=>{s.target.closest("input, select, textarea, .pwd-btn")||t.querySelectorAll(".validate-form__input.click").forEach(a=>{const r=a.querySelector("input, textarea, select");a.classList.remove("click"),r&&(r.tagName==="INPUT"||r.tagName==="TEXTAREA")&&(r.value??"").trim()===""&&a.classList.remove("text-on")})};t.addEventListener("click",e),document.addEventListener("click",n);const o=()=>{t.removeEventListener("click",e),document.removeEventListener("click",n),T.delete(t)};return T.set(t,o),o},x=t=>{if(!t)return;t.querySelectorAll(".validate-form__input").forEach(n=>{n.querySelectorAll("input, select, textarea").forEach(s=>{Lt(s,n,t)})})},Lt=(t,e,n)=>{if(t.disabled)return!0;const o=G(t,{root:n});return nt(e,o),o.ok},Z=new WeakSet,y=t=>{if(!t||Z.has(t))return;Z.add(t);const e=()=>A(t);e(),t.addEventListener("input",e),t.addEventListener("change",e),t.querySelectorAll(".next-btn, .prev-btn").forEach(n=>{n.addEventListener("click",()=>{requestAnimationFrame(e)})})},A=t=>{if(!t)return!1;const n=t.querySelector(".step.visible")||t,s=[...n.querySelectorAll("[required]")].every(r=>G(r,{root:n}).ok);return t.querySelectorAll(".submit-btn").forEach(r=>{s?r.classList.remove("disabled"):r.classList.add("disabled"),r.disabled=!s}),s},I=t=>{t&&wt(t)},O=new WeakMap,q=t=>{if(!t)return;O.has(t)||O.set(t,new WeakSet);const e=O.get(t);t.addEventListener("click",n=>{var s;const o=(s=n.target)==null?void 0:s.closest("input, select, textarea");!o||!t.contains(o)||o.disabled||e.has(o)||(Dt(o,t),e.add(o))})},Dt=(t,e)=>{if(!t||t.disabled)return;const n=t.tagName==="SELECT",o=t.type==="radio"||t.type==="checkbox",s=n||o?"change":"input",a=()=>{const r=(e==null?void 0:e.querySelector(".step.visible"))??e??t.form??document,i=t.closest(".validate-form__input"),c=G(t,{root:r});nt(i,c)};t.addEventListener(s,a)},kt=()=>{const t=document.querySelector(".basic-info-form");y(t),t&&t.addEventListener("submit",e=>{e.preventDefault()})},At=Object.freeze(Object.defineProperty({__proto__:null,init:kt},Symbol.toStringTag,{value:"Module"})),h=t=>{const e=t.replace(/^\/+/,"");return`${BASE_PATH}${e}`},xt=t=>{const e=new Image;e.src=t},It=async(t,e)=>{var n;console.log("通信エラー:",t);try{const o=(n=e==null?void 0:e.headers)==null?void 0:n.get("Content-Type");o&&o.includes("application/json")?(console.log("サーバーレスポンス:",await e.json()),alert(`モーダルの読み込みに失敗しました。
`+t.message)):console.log("サーバーレスポンス:",await e.text())}catch(o){console.error("エラー内容の解析中に失敗しました:",o)}},p=async(t,e="GET",n=null,o={})=>{const s=await fetch(t,{method:e,body:n,...o});try{if(!s.ok)throw new Error(`APIエラー: ${s.status}`);const a=s.headers.get("Content-Type");return a&&a.includes("application/json")?await s.json():await s.text()}catch(a){return await It(a,s),{success:!1,message:"通信エラーが発生しました。"}}},ot=async t=>p(h(`/index.php?modal=${t}`)),qt=async t=>p(h("/index.php?modal=login"),"POST",t),Tt=async t=>p(h("/index.php?modal=register"),"POST",t),Ct=async()=>p(h("/api/chart_data.php")),Y=t=>{const e=t.closest("[data-date]");return e?e.dataset.date:null};let C={};const st=async t=>{const e=Y(t);if(!e)return null;if(C[e])return C[e];const n=await p(h(`/api/record_data.php?date=${e}`));return n&&n.date?(C[e]=n,C[e]):null},Mt=async t=>p(h("/index.php?modal=recordAdmin"),"POST",t),Rt=async t=>p(h("/index.php?modal=record"),"POST",t),Bt=async t=>p(h("/index.php?modal=recordDelete"),"POST",t),Ft=async t=>p(h("/index.php?modal=recordReset"),"POST",t);let M=null;const Ot=async()=>{if(M)return M;const t=await p(h("/api/user_data.php"));return t&&t.username?(M=t,M):null},Pt=async t=>p(h("/index.php?modal=adminUser"),"POST",t),$t=async t=>p(h("/index.php?modal=adminAccount"),"POST",t),jt=async t=>p(h("/index.php?modal=accountDelete"),"POST",t),Nt=()=>{document.querySelector(".account-delete")&&document.getElementById("acc-delete-btn").addEventListener("click",async n=>{n.preventDefault();const o=await jt();window.history.scrollRestoration="manual",window.location.reload(),o.success||alert(o.message)})},Ut=Object.freeze(Object.defineProperty({__proto__:null,init:Nt},Symbol.toStringTag,{value:"Module"})),tt=new WeakSet,P=new WeakSet,Q=(t,e)=>{document.querySelectorAll(t).forEach(o=>{if(tt.has(o))return;tt.add(o);const s=i=>{const c=i.target;P.has(c)||i.isComposing===!0||e(c)},a=i=>{P.add(i.target)},r=i=>{const c=i.target;P.delete(c),e(c)};o.addEventListener("input",s),o.addEventListener("change",s),o.addEventListener("compositionstart",a),o.addEventListener("compositionend",r),o.addEventListener("compositioncancel",r)})},B=(t,e)=>{const n=t.value;if(e===n)return;const o=typeof t.selectionStart=="number"&&typeof t.selectionEnd=="number",s=o?t.selectionStart:null,a=o?t.selectionEnd:null,r=o&&s===n.length&&a===n.length;if(t.value=e,!o)return;if(r){t.selectionStart=t.selectionEnd=e.length;return}const i=e.length-n.length,c=Math.max(0,Math.min(e.length,(s??0)+i)),l=Math.max(0,Math.min(e.length,(a??0)+i));t.selectionStart=c,t.selectionEnd=l},J=t=>{Q(t,e=>{const n=e.value.replace(/[^a-zA-Z0-9 !"#$%&'()*+,-./:;<=>?@[\\\]^_`{|}~]/g,"");B(e,n)})},Ht=t=>{Q(t,e=>{const n=e.value.replace(/[^0-9]/g,"");B(e,n)})},k=t=>{Q(t,e=>{let n=e.value;n=n.replace(/[^0-9.]/g,"");const o=n.indexOf(".");o!==-1&&(n=n.slice(0,o+1)+n.slice(o+1).replace(/\./g,""));const s=parseFloat(n);if(!isNaN(s)&&s>999.9){B(e,"999.9");return}const[a="",r=""]=n.split("."),i=a.slice(0,3),c=r.slice(0,1);n=c!==""||n.includes(".")?`${i}.${c}`:i,B(e,n)})},Vt=async()=>{const t=document.getElementById("login-form");y(t),q(t),I(t),J("input[data-alphanumeric]"),Ht("input[data-numeric]"),t&&t.addEventListener("submit",async e=>{if(e.preventDefault(),x(t),!A(t)){console.log("バリデーションエラー： フォーム送信をキャンセル");return}const o=new FormData(t),s=await qt(o),a=document.querySelector(".form-message");s.success?window.location.href=h("/home"):(a.classList.add("error"),a.innerHTML=`ログインに失敗しました。<br>${s.errorMessage}`,a.style.display="block")})},Wt=Object.freeze(Object.defineProperty({__proto__:null,init:Vt},Symbol.toStringTag,{value:"Module"})),at=()=>{const t=document.getElementById("step1"),e=document.getElementById("step2");if(!t||!e)return;const n=document.querySelectorAll(".btn--go-to-step2, #btn--go-to-step2"),o=document.getElementById("btn--back-to-step1"),s=r=>{r.preventDefault(),zt(t,e)},a=r=>{r.preventDefault(),Gt(t,e)};n.forEach(r=>r.addEventListener("click",s)),o.addEventListener("click",a)},zt=(t,e)=>{t.classList.add("hidden"),t.classList.remove("visible"),e.classList.add("visible"),e.classList.remove("hidden")},Gt=(t,e)=>{e.classList.add("hidden"),e.classList.remove("visible"),t.classList.add("visible"),t.classList.remove("hidden")},Yt=()=>{at();const t=document.querySelectorAll(".notice-contents"),e=document.querySelectorAll(".notice-detail"),n=s=>{e.forEach(a=>{a.classList.toggle("visible",a.id===s),a.classList.toggle("hidden",a.id!==s)})};t.forEach(s=>{s.addEventListener("click",()=>{n(s.dataset.notice)})});const o=document.querySelector("#header__notifications span");o.dataset.icon="notifications"},Qt=Object.freeze(Object.defineProperty({__proto__:null,init:Yt},Symbol.toStringTag,{value:"Module"})),Jt=t=>{const e=document.querySelector(".modal-record-admin"),n=document.getElementById("record-form");if(I(n),q(n),k("input[data-weight-input]"),t){const o=t.date.replace(/-/g,"/");e.querySelector(".date__contents").textContent=o,e.querySelector("#recorded_at").value=o,e.querySelector("#weight").value=t.weight,e.querySelector("#memo").value=t.memo||""}y(n),document.addEventListener("input",y(n)),document.addEventListener("change",y(n)),n&&(n.addEventListener("submit",async s=>{if(s.preventDefault(),x(n),!A(n)){console.log("バリデーションエラー： フォーム送信をキャンセル");return}const r=new FormData(n),i=await Mt(r);window.history.scrollRestoration="manual",window.location.reload(),i.success||alert(i.message)}),document.getElementById("delete-btn").addEventListener("click",async s=>{s.preventDefault();const a=new FormData(n),r=await Bt(a);window.history.scrollRestoration="manual",window.location.reload(),r.success||alert(r.message)}))},Xt=Object.freeze(Object.defineProperty({__proto__:null,init:Jt},Symbol.toStringTag,{value:"Module"})),Kt=()=>{document.querySelector(".record-reset")&&document.getElementById("reset-btn").addEventListener("click",async n=>{n.preventDefault();const o=await Ft();window.history.scrollRestoration="manual",window.location.reload(),o.success||alert(o.message)})},Zt=Object.freeze(Object.defineProperty({__proto__:null,init:Kt},Symbol.toStringTag,{value:"Module"})),te=()=>{const t=document.getElementById("date-contents"),e=document.getElementById("date-prev"),n=document.getElementById("date-next"),o=document.getElementById("recorded_at");if(!t&&!o&&!e&&!n)return;const s={dateContents:t,inputRecordedAt:o,dateNextBtn:n},a=ee();let r={selectedDate:a,today:a};r=$(r,"init"),j(s,r),e&&e.addEventListener("click",()=>{r=$(r,"prev"),j(s,r)}),n&&n.addEventListener("click",()=>{r=$(r,"next"),j(s,r)})},ee=()=>{const t=new Date,n=new Intl.DateTimeFormat("ja-JP",{timeZone:"Asia/Tokyo",year:"numeric",month:"2-digit",day:"2-digit"}).formatToParts(t),o=n.find(r=>r.type==="year").value,s=n.find(r=>r.type==="month").value,a=n.find(r=>r.type==="day").value;return new Date(`${o}-${s}-${a}T00:00:00+09:00`)},ne=t=>{const e=a=>("0"+a).slice(-2),n=t.getFullYear().toString(),o=e(t.getMonth()+1).toString(),s=e(t.getDate()).toString();return`${n}/${o}/${s}`},$=(t,e)=>{let{today:n}=t;const o=new Date(t.selectedDate);e==="prev"?o.setDate(o.getDate()-1):e==="next"&&o.getTime()<n.getTime()&&o.setDate(o.getDate()+1);const s=ne(o),a=o.getTime()<n.getTime();return{selectedDate:o,today:n,display:s,canGoNext:a}},j=(t,e)=>{const{dateContents:n,inputRecordedAt:o,dateNextBtn:s}=t;n&&(n.textContent=e.display),o&&(o.value=e.display),s&&(s.disabled=!e.canGoNext)},oe=async()=>{const t=document.getElementById("record-form");te(),I(t),q(t),k("input[data-weight-input]"),y(t),document.addEventListener("input",y(t)),document.addEventListener("change",y(t)),t&&t.addEventListener("submit",async e=>{if(e.preventDefault(),x(t),!A(t)){console.log("バリデーションエラー： フォーム送信をキャンセル");return}const o=new FormData(t),s=await Rt(o);window.history.scrollRestoration="manual",window.location.reload(),s.success||alert(s.message)})},se=Object.freeze(Object.defineProperty({__proto__:null,init:oe},Symbol.toStringTag,{value:"Module"})),rt=()=>{const t=document.getElementById("birth-year"),e=document.getElementById("birth-month"),n=document.getElementById("birth-day");if(!t||!e||!n)return;if(t.options.length<=1){const a=new Date().getFullYear();for(let r=a;r>=a-100;r--){let i=document.createElement("option");i.value=String(r),i.textContent=String(r),t.appendChild(i)}}const o=a=>a!==""&&Number.isFinite(+a)?+a:null,s=()=>{const a=o(t.value),r=o(e.value),i=o(n.value),c=ae(a,r,i);re({yearSelect:t,monthSelect:e,daySelect:n},c)};t.addEventListener("change",s),e.addEventListener("change",s),requestAnimationFrame(s)},ae=(t,e,n)=>{const o=t==null,s=t==null||e==null;let a=null;s||(a=new Date(t,e,0).getDate());let r=null;return n!=null&&a!=null&&(r=Math.min(n,a)),{monthDisabled:o,dayDisabled:s,maxDay:a,nextDayValue:r}},re=({yearSelect:t,monthSelect:e,daySelect:n},o)=>{const{monthDisabled:s,dayDisabled:a,maxDay:r,nextDayValue:i}=o;for(e.disabled=s,n.disabled=a;n.options.length>1;)n.remove(1);if(r!=null)for(let c=1;c<=r;c++){const l=document.createElement("option");l.value=String(c),l.textContent=String(c),n.appendChild(l)}i!=null?(n.value=String(i),n.value!==String(i)&&r!=null&&(n.value=String(r))):n.value=""},ie=()=>{const t=document.getElementById("register-form");rt(),I(t),y(t),q(t),J("input[data-alphanumeric]"),k("input[data-height-input]"),k("input[data-weight-input]"),at(),t&&t.addEventListener("submit",async e=>{if(e.preventDefault(),x(t),!A(t)){console.log("バリデーションエラー： フォーム送信をキャンセル");return}const o=new FormData(t),s=await Tt(o),a=document.querySelector(".form-message");s.success?(sessionStorage.setItem("accountCreated","true"),window.location.href=h("/home")):(a.classList.add("error"),a.innerHTML=`新規登録に失敗しました。<br>${s.errorMessage}`,a.style.display="block")})},ce=Object.freeze(Object.defineProperty({__proto__:null,init:ie},Symbol.toStringTag,{value:"Module"})),le=t=>{const e=document.querySelector("#user-info-form");rt(),I(e),q(e),J("input[data-alphanumeric]"),k("input[data-height-input]"),k("input[data-weight-input]");const n=document.querySelector(".admin-account-form"),o=document.querySelector(".admin-user-form"),s=document.querySelector(".modal");if(t){s.querySelector("#username").value=t.username,s.querySelector("#birth-year").value=t.birth_year,s.querySelector("#birth-month").value=t.birth_month,requestAnimationFrame(()=>{s.querySelector("#birth-day").value=t.birth_day});const a=document.querySelector(`input[name="gender"][value="${t.gender}`);a.checked=!0,s.querySelector("#height").value=t.height,s.querySelector("#ideal-weight").value=t.ideal_weight}y(e),document.addEventListener("input",y(e)),document.addEventListener("change",y(e)),e&&e.addEventListener("submit",async a=>{if(a.preventDefault(),x(e),!A(e)){console.log("バリデーションエラー： フォーム送信をキャンセル");return}const i=new FormData(e);let c;n&&(c=await $t(i)),o&&(c=await Pt(i)),window.history.scrollRestoration="manual",window.location.reload(),c.success||alert(c.message)})},de=Object.freeze(Object.defineProperty({__proto__:null,init:le},Symbol.toStringTag,{value:"Module"})),ue="visibility",me="visibility_off",fe="パスワードを表示",ge="パスワードを非表示",he=()=>{const t=document.querySelectorAll(".pwd-btn");t.length&&t.forEach(e=>{if(e.dataset.inited==="1")return;e.dataset.inited="1",lt(e);const n=()=>pe(e);e.addEventListener("click",n)})},pe=t=>{const e=it(t);e&&(ye(t,!ct(t)),lt(t,e))},it=t=>{const e=t.previousElementSibling;return e&&e.tagName.toLowerCase()==="input"?e:null},ye=(t,e)=>t.dataset.hidden=String(e),ct=t=>t.dataset.hidden==="true",lt=(t,e=it(t))=>{if(!e)return;const n=ct(t);ve(e,n),be(t,n),Se(t,e,n)},ve=(t,e)=>{t.type=e?"password":"text"},be=(t,e)=>{const n=t.querySelector("[data-icon]");n&&(n.dataset.icon=e?ue:me)},Se=(t,e,n)=>{e.id&&t.setAttribute("aria-controls",e.id),t.setAttribute("aria-pressed",String(!n)),t.setAttribute("aria-label",Ee(n))},Ee=t=>t?fe:ge,dt=document.querySelector("body"),_e=document.getElementById("layout");let N=!1;const V=new Map,_=new Map,we=(t,e)=>{const n={record:"./init/record.js",recordAdmin:"./init/record-admin.js",recordReset:"./init/record-reset.js",adminAccount:"./init/user-info.js",adminUser:"./init/user-info.js",login:"./init/login.js",register:"./init/register.js",accountCreated:"./init/account-created.js",accountDelete:"./init/account-delete.js",notifications:"./init/notifications.js"},o=Object.assign({"./init/account-created.js":At,"./init/account-delete.js":Ut,"./init/login.js":Wt,"./init/notifications.js":Qt,"./init/record-admin.js":Xt,"./init/record-reset.js":Zt,"./init/record.js":se,"./init/register.js":ce,"./init/user-info.js":de}),s=n[t],a=o[s];s&&typeof a.init=="function"&&a.init(e)},et=async(t,e=null)=>{const n=t;let o=t,s=null;if(t==="recordAdmin"&&e){const r=Y(e);if(!r)return;o=`recordAdmin-${r}`,_.has(o)||(s=await st(e),_.set(o,s))}if(t==="adminUser"&&!_.has(o)&&(s=await Ot(),_.set(o,s)),t==="record"&&xt("/images/date-arrow.svg"),V.has(n))return;const a=await ot(t);V.set(n,a)},X=async(t,e=null)=>{if(N)return;N=!0;const n=V.get(t)||await ot(t),o=e?_.get(e):null;_e.insertAdjacentHTML("afterend",n),dt.style.overflow="hidden",he(),we(t,o),document.querySelectorAll(".close-modal").forEach(a=>{a&&a.addEventListener("click",ut)}),N=!1},ut=()=>{const t=document.getElementById("modal");t&&(t.remove(),dt.style.overflow="")},mt=document.querySelectorAll("[data-modal]");mt.forEach(t=>{t.addEventListener("click",async()=>{const e=t.getAttribute("data-modal");let n=e;if(e==="recordAdmin"){const o=Y(t);o&&(n=`recordAdmin-${o}`)}if(!_.has(n)){const o=await st(t);_.set(n,o)}X(e,n)})});document.addEventListener("click",t=>{const e=document.querySelector("#modal.record, #modal.recordAdmin");e&&t.target===e&&ut()});const ft=new Set;mt.forEach(t=>{const e=t.getAttribute("data-modal");ft.add(e)});const Le=document.querySelectorAll('[data-modal="recordAdmin"]');window.addEventListener("load",()=>{setTimeout(async()=>{const t=[...ft].map(e=>et(e));await Promise.all(t);for(const e of Le)await et("recordAdmin",e)},1e3)});sessionStorage.getItem("accountCreated")==="true"&&(X("accountCreated"),sessionStorage.removeItem("accountCreated"));showIdModal&&X("idCheck");const De=()=>{const t=document.getElementById("header");if(!t)return;const e=t.offsetHeight;let n=0;window.addEventListener("load",()=>{window.addEventListener("scroll",()=>{const i=window.scrollY||document.documentElement.scrollTop;i>n&&i>e?t.style.top=`-${e}px`:t.style.top="0",n=i})});const o=document.getElementById("menu-toggle"),s=document.querySelector(".layout__sidebar");o.addEventListener("click",()=>{s.classList.contains("open")?(s.classList.remove("open"),s.classList.add("close")):(s.classList.remove("close"),s.classList.add("open"))});const a=window.matchMedia("(max-width: 1299px)"),r=i=>{i.matches?(s.classList.remove("open"),s.classList.add("close")):(s.classList.remove("close"),s.classList.add("open"))};r(a),a.addEventListener("change",r),document.addEventListener("click",i=>{i.target.closest(".layout__sidebar")||a.matches&&(s.classList.remove("open"),s.classList.add("close"))})},ke=()=>{const t=document.querySelectorAll(".accordion-btn");t.length&&t.forEach((e,n)=>{Ae(e,n),e.addEventListener("click",()=>xe(e))})},Ae=(t,e)=>{const n=t.closest(".accordion"),o=n==null?void 0:n.querySelector(".accordion-content");if(!n||!o)return;const s=`accordion-btn-${e+1}`,a=`accordion-panel-${e+1}`;t.id=s,t.setAttribute("aria-controls",a),t.setAttribute("aria-expanded","false"),o.id=a,o.setAttribute("role","region"),o.setAttribute("aria-labelledby",s),o.hidden=!0,o.style.maxHeight="0",n.setAttribute("data-state","close")},xe=t=>{const e=t.closest(".accordion"),n=e==null?void 0:e.querySelector(".accordion-content");if(!e||!n)return;e.getAttribute("data-state")==="open"?qe(e,t,n):Ie(e,t,n)},Ie=(t,e,n)=>{n.hidden=!1,n.style.maxHeight="0",requestAnimationFrame(()=>{n.style.maxHeight=n.scrollHeight+"px"}),e.setAttribute("aria-expanded","true"),t.setAttribute("data-state","open")},qe=(t,e,n)=>{n.style.maxHeight=n.scrollHeight+"px",requestAnimationFrame(()=>{n.style.maxHeight="0"});const o=s=>{s.propertyName==="max-height"&&(n.hidden=!0,n.removeEventListener("transitionend",o))};n.addEventListener("transitionend",o),e.setAttribute("aria-expanded","false"),t.setAttribute("data-state","close")},Te=()=>{const t=document.getElementById("header__info"),e=document.getElementById("header__profile"),n=document.getElementById("user-popup");!t||!e||!n||(Ce(e,n),e.addEventListener("click",o=>{o.stopPropagation(),Me(t,e)}),document.addEventListener("click",o=>{n.contains(o.target)||gt(t,e)}))},Ce=(t,e)=>{t.setAttribute("aria-controls",e.id),t.setAttribute("aria-expanded","false")},Me=(t,e)=>{t.classList.contains("click")?gt(t,e):Re(t,e)},Re=(t,e)=>{t.classList.add("click"),e.setAttribute("aria-expanded","true")},gt=(t,e)=>{t.classList.remove("click"),e.setAttribute("aria-expanded","false")},Be="IDをコピーしました。",W="copy-dialog",Fe=10,Oe=1500,Pe=2e3,$e=(t=document,{message:e=Be}={})=>{const n=async o=>{const s=o.target.closest(".copy-link");if(!s)return;const a=s.closest(".copy-contents"),r=a==null?void 0:a.querySelector(".copy__value");if(r&&!document.querySelector(`.${W}`))try{await navigator.clipboard.writeText(r.textContent),je(e)}catch{}};t.addEventListener("click",n)},je=t=>{const e=Ne();Ue(e,t)},Ne=()=>{let t=document.querySelector(`.${W}`);return t||(t=document.createElement("div"),t.classList.add(W),t.setAttribute("role","status"),t.setAttribute("aria-live","polite"),t.setAttribute("aria-atomic","true"),document.body.appendChild(t)),t},Ue=(t,e)=>{t.textContent=e,setTimeout(()=>t.classList.add("show"),Fe),setTimeout(()=>t.classList.remove("show"),Oe),setTimeout(()=>t.remove(),Pe)},He=()=>{const t=document.querySelector(".weight-days__blocks"),e=document.querySelector(".weight-days .btn--more"),n=[...document.querySelectorAll(".weight-days__switch button")],o={parent:t,btnMore:e,switchBtns:n},s=[...document.querySelectorAll(".weight-days__block")];if(!t||!s.length)return;const a=s.map(l=>({el:l,dateStr:l.querySelector(".weight-days__date").textContent.trim()})),r=6,i={sort:"new",showNum:r};let c=U(a,i);H(o,a,c),e&&e.addEventListener("click",()=>{i.showNum+=r,c=U(a,i),H(o,a,c)}),n.forEach(l=>{l.addEventListener("click",()=>{i.sort=l.dataset.sort==="old"?"old":"new",c=U(a,i),H(o,a,c)})})},U=(t,e)=>{const{sort:n,showNum:o}=e,s=l=>t[l].dateStr.trim(),a=t.map((l,d)=>d).sort((l,d)=>n==="old"?s(l).localeCompare(s(d)):s(d).localeCompare(s(l))),r=Math.min(o,t.length),i=r<t.length;return{order:a,visibleCount:r,canShowMore:i,selectedSort:n}},H=(t,e,n)=>{const{parent:o,btnMore:s,switchBtns:a}=t,{order:r,visibleCount:i,canShowMore:c,selectedSort:l}=n;if(!o)return;const d=new DocumentFragment;r.forEach((f,g)=>{const v=e[f].el;g<i?v.classList.add("show"):v.classList.remove("show"),d.appendChild(v)}),o.innerHTML="",o.appendChild(d),c||s.classList.add("hide"),a&&a.length&&a.forEach(f=>{f.classList.toggle("btn--select",f.dataset.sort===l)})},Ve=async(t={})=>{const e=document.getElementById("graph");if(!e)return;const n=new Date,{fetchChartData:o=Ct}=t,s=await o(),a=s.chart_arr,r=s.ideal_weight;Chart.register(window["chartjs-plugin-annotation"]);const i=window.matchMedia("(max-width: 599px)");let c;const l=()=>{c=Ye(g,{today:n,weightRecords:a,graphElement:e,weightChart:c,mediaQueryChart:i,idealWeight:r})},d=()=>{const u=Ge(g,{today:n,weightRecords:a});Qe(S,u)},f=document.querySelector(".weight-graph__date");let g="1m";l(),D(g,{today:n,weightGraphDate:f}),i.addEventListener("change",()=>l());const v=document.querySelectorAll(".weight-graph__switch button"),S=document.querySelectorAll(".weight-summary__block");v.length<1||(v.forEach(u=>{u.addEventListener("click",()=>{var m;(m=document.querySelector(".weight-graph__switch .btn--select"))==null||m.classList.remove("btn--select"),u.classList.add("btn--select")})}),d(),document.getElementById("weight-graph__week").addEventListener("click",()=>{g="7d",l(),D(g,{today:n,weightGraphDate:f}),d()}),document.getElementById("weight-graph__month").addEventListener("click",()=>{g="1m",l(),D(g,{today:n,weightGraphDate:f}),d()}),document.getElementById("weight-graph__three-month").addEventListener("click",()=>{g="3m",l(),D(g,{today:n,weightGraphDate:f}),d()}),document.getElementById("weight-graph__half-year").addEventListener("click",()=>{g="6m",l(),D(g,{today:n,weightGraphDate:f}),d()}),document.getElementById("weight-graph__year").addEventListener("click",()=>{g="1y",l(),D(g,{today:n,weightGraphDate:f}),d()}))},R=t=>new Date(t.getTime()),F=(t,{today:e,isPrev:n=!1})=>{const o=R(e);o.setHours(0,0,0,0);let s=R(o);s.setDate(o.getDate()+1);let a=R(s);const r={"7d":[7,14],"1m":[1,2],"3m":[3,6],"6m":[6,12],"1y":[12,24]};if(t==="7d"){const d=r[t][0];n&&(s.setDate(s.getDate()-d),a=new Date(s.getTime())),a.setDate(s.getDate()-d)}else{const d=r[t][0];n&&(s.setMonth(s.getMonth()-d),a=new Date(s.getTime())),a.setMonth(s.getMonth()-d)}const i=d=>`${d.getFullYear()}-${String(d.getMonth()+1).padStart(2,"0")}-${String(d.getDate()).padStart(2,"0")}`;let c=[],l=R(a);for(;l<s;)c.push(i(l)),l.setDate(l.getDate()+1);return c},z=(t,e)=>{const n=Object.fromEntries(t.map(c=>[c.date,c.weight])),o=Object.fromEntries(t.map(c=>[c.date,c.bmi])),s=Object.fromEntries(t.map(c=>[c.date,c.bfp])),a=e.map(c=>n[c]??null),r=e.map(c=>o[c]??null),i=e.map(c=>s[c]??null);return{labels:e,dataset:a,bmi:r,bfp:i}},We=(t,e,n)=>{if(!e.length)return t.slice();const o=Math.ceil(e.length/n);let s=0;return t.map((a,r,i)=>{const c=i.length-1,l=c-r;if(r===c||l%o===0){const f=t.slice(s,r+1).filter(S=>S),g=f.reduce((S,u)=>parseFloat(S)+parseFloat(u),0);return s=r+1,g?(g/f.length).toFixed(1):null}else return null})},ze=(t,e)=>{const n=F(t,{today:e}).map(a=>a.replaceAll("-","/"));if(!n.length)return"--";const o=n[0],s=n[n.length-1];return`${o}～${s}`},Ge=(t,{today:e,weightRecords:n})=>{const o=F(t,{today:e,isPrev:!1}),s=F(t,{today:e,isPrev:!0}),a=z(n,o),r=a.dataset.filter(m=>m!==null),i=a.bmi.filter(m=>m!==null),c=a.bfp.filter(m=>m!==null),d=z(n,s).dataset.filter(m=>m!==null),f=(m,E=1)=>{const b=m.filter(L=>L!=null).map(L=>parseFloat(L.replace(/,/g,"")));return b.length?(b.reduce((L,ht)=>L+ht,0)/b.length).toFixed(E):null},g=(m,E)=>{if(m.length&&E.length){const b=(f(m)-f(E)).toFixed(1);return b>0?"+"+b:String(b)}else return null},v=m=>m.length?Math.max(...m).toFixed(1):null,S=m=>m.length?Math.min(...m).toFixed(1):null;let u;return t==="7d"&&(u="1週間"),t==="1m"&&(u="1ヶ月"),t==="3m"&&(u="3ヶ月"),t==="6m"&&(u="半年"),t==="1y"&&(u="1年"),{rangeText:u,average:f(r),bfp:f(c,2),bmi:f(i,2),in_de:g(r,d),best:v(r),lowest:S(r)}},Ye=(t,{today:e,weightRecords:n,graphElement:o,weightChart:s,mediaQueryChart:a,idealWeight:r})=>{const i=F(t,{today:e,isPrev:!1}),{labels:c,dataset:l}=z(n,i);s&&s.destroy();const d=Chart.getChart(o);d&&d.destroy();const f=a.matches?12:31,g=We(l,c,f),v=c.map(u=>u.replaceAll("-","/")),S=o.getContext("2d");if(s=new Chart(S,{type:"line",data:{labels:v,datasets:[{label:"体重（kg）",data:g,backgroundColor:"#4a90e2",borderColor:"#4a90e2",borderWidth:2,pointRadius:4,pointBackgroundColor:"#fff",pointBorderColor:"#4a90e2",pointBorderWidth:3,hoverBorderWidth:4,pointHoverRadius:6,spanGaps:!0}]},options:{responsive:!0,maintainAspectRatio:!0,aspectRatio:a.matches?4/3:2/1,animation:{duration:800},animations:{y:{from(u){if(u.type==="data"&&u.mode==="default"&&u.parsed.y!=null){const m=u.chart.scales.y;return m.getPixelForValue(m.min)}}}},scales:{x:{ticks:{autoSkip:!0,callback(u){return c[u]?`${new Date(c[u]).getDate()}日`:""},maxRotation:0,minRotation:0,maxTicksLimit:15}},y:{suggestedMax:Math.max(...l.filter(u=>u!=null).map(Number))+1,suggestedMin:r-1,ticks:{maxTicksLimit:a.matches?6:8}}},plugins:{legend:{display:!1},tooltip:{titleFont:{size:a.matches?10:12,family:"Inter, Noto Sans JP, sans-serif"},bodyFont:{size:a.matches?12:14,family:"Inter, Noto Sans JP, sans-serif"},callbacks:{label(u){return` 体重: ${u.raw} kg`}}},annotation:{annotations:{goalLine:{type:"line",yMin:r,yMax:r,borderColor:"#e65100",borderWidth:2,borderDash:[6,6],label:{content:"目標体重",enabled:!0,position:"end"}}}}}}}),t==="3m"||t==="6m"||t==="1y"){let u=null;s.options.scales.x.ticks.callback=m=>{let E=new Date(c[m]),b=E.getMonth()+1,K=E.getDate();if(!(b===u||K!==1))return u=b,`${b}月`},s.update()}return s},D=(t,{today:e,weightGraphDate:n})=>{n.textContent=ze(t,e)},Qe=(t,e)=>{t.forEach(n=>{const o=n.querySelector(".period");o&&(o.textContent=e.rangeText??"--");const s=n.dataset.summary,a=e[s],r=n.querySelector(".weight-summary__num");r&&(r.textContent=a??"--")})};document.querySelector("#header")&&De();document.querySelector(".accordion")&&ke();document.querySelector("#header__info")&&Te();$e();document.querySelector(".weight-days__blocks")&&He();document.querySelector("#graph")&&Ve();
