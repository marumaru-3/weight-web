const w={REQUIRED:"required",TOO_SHORT:"too_short"},G=(e,{root:t}={})=>{if(e.disabled)return{ok:!0};if(e.type==="radio")return he(e,{root:t});if(e.type==="checkbox")return ye(e);const n=(e.value??"").trim();return e.id==="password"?ve(n):e.tagName==="SELECT"?be(e):e.tagName==="INPUT"||e.tagName==="TEXTAREA"?Se(e,n):{ok:!0}},he=(e,{root:t}={})=>{const n=t??e.form??document,o=Array.from(n.querySelectorAll(`input[type="radio"][name="${e.name}"]`));return o.length===0?e.required&&!e.checked?{ok:!1,code:w.REQUIRED}:{ok:!0}:o.some(r=>r.required)?o.some(r=>r.checked)?{ok:!0}:{ok:!1,code:w.REQUIRED}:{ok:!0}},ye=e=>e.required&&!e.checked?{ok:!1,code:w.REQUIRED}:{ok:!0},ve=e=>e===""?{ok:!1,code:w.REQUIRED}:e.length<4?{ok:!1,code:w.TOO_SHORT,payload:{min:4}}:{ok:!0},be=e=>e.required&&(e.value===""||e.selectedIndex===-1)?{ok:!1,code:w.REQUIRED}:{ok:!0},Se=(e,t)=>e.required&&t===""?{ok:!1,code:w.REQUIRED}:{ok:!0},Ee={required:e=>`${e}を入力してください`,too_short:(e,t)=>`${e}は${(t==null?void 0:t.min)??4}文字以上で入力してください`},_e=e=>{const t=e.querySelector(".label-title, .label-name"),n=(t==null?void 0:t.textContent.trim())??"";return n.includes("（")?n.substring(0,n.indexOf("（")):n},ne=(e,t)=>{if(!e||!t)return;const n="validate-form__input";let o=null;if(e.classList&&e.classList.contains(n)&&(o=e),!o&&e.closest){const i=e.closest(`.${n}`);i&&(o=i)}if(!o&&e.querySelector){const i=e.querySelector(`.${n}`);i&&(o=i)}o||(o=e);const s=o.closest(".basic-info-form__box")||null,a=s.querySelector(".validate-text")||null;if(!a)return;const r=_e(s);if(t.ok)a.textContent="",o.classList.remove("no-text"),o.setAttribute("aria-invalid","false");else{const c=(Ee[t.code]||(()=>""))(r,t.payload);a.textContent=c,o.classList.add("no-text"),o.setAttribute("aria-invalid","true")}},T=new WeakMap,we=(e=document)=>{if(T.has(e))return T.get(e);const t=s=>{let a=s.target.closest("input, select, textarea");if(!a){const i=s.target.closest("label");if(i){const c=i.getAttribute("for");a=c?e.querySelector(`#${c}`):i.querySelector("input, select, textarea")}}if(!a||!e.contains(a))return;const r=a.closest(".validate-form__input");r&&(r.classList.add("click"),a&&(a.tagName==="INPUT"||a.tagName==="TEXTAREA")&&r.classList.add("text-on"))},n=s=>{s.target.closest("input, select, textarea, .pwd-btn")||e.querySelectorAll(".validate-form__input.click").forEach(a=>{const r=a.querySelector("input, textarea, select");a.classList.remove("click"),r&&(r.tagName==="INPUT"||r.tagName==="TEXTAREA")&&(r.value??"").trim()===""&&a.classList.remove("text-on")})};e.addEventListener("click",t),document.addEventListener("click",n);const o=()=>{e.removeEventListener("click",t),document.removeEventListener("click",n),T.delete(e)};return T.set(e,o),o},x=e=>{if(!e)return;e.querySelectorAll(".validate-form__input").forEach(n=>{n.querySelectorAll("input, select, textarea").forEach(s=>{Le(s,n,e)})})},Le=(e,t,n)=>{if(e.disabled)return!0;const o=G(e,{root:n});return ne(t,o),o.ok},Z=new WeakSet,y=e=>{if(!e||Z.has(e))return;Z.add(e);const t=()=>A(e);t(),e.addEventListener("input",t),e.addEventListener("change",t),e.querySelectorAll(".next-btn, .prev-btn").forEach(n=>{n.addEventListener("click",()=>{requestAnimationFrame(t)})})},A=e=>{if(!e)return!1;const n=e.querySelector(".step.visible")||e,s=[...n.querySelectorAll("[required]")].every(r=>G(r,{root:n}).ok);return e.querySelectorAll(".submit-btn").forEach(r=>{s?r.classList.remove("disabled"):r.classList.add("disabled"),r.disabled=!s}),s},I=e=>{e&&we(e)},O=new WeakMap,q=e=>{if(!e)return;O.has(e)||O.set(e,new WeakSet);const t=O.get(e);e.addEventListener("click",n=>{var s;const o=(s=n.target)==null?void 0:s.closest("input, select, textarea");!o||!e.contains(o)||o.disabled||t.has(o)||(De(o,e),t.add(o))})},De=(e,t)=>{if(!e||e.disabled)return;const n=e.tagName==="SELECT",o=e.type==="radio"||e.type==="checkbox",s=n||o?"change":"input",a=()=>{const r=(t==null?void 0:t.querySelector(".step.visible"))??t??e.form??document,i=e.closest(".validate-form__input"),c=G(e,{root:r});ne(i,c)};e.addEventListener(s,a)},ke=()=>{const e=document.querySelector(".basic-info-form");y(e),e&&e.addEventListener("submit",t=>{t.preventDefault()})},Ae=Object.freeze(Object.defineProperty({__proto__:null,init:ke},Symbol.toStringTag,{value:"Module"})),g=e=>{const t=e.replace(/^\/+/,"");return`${BASE_PATH}${t}`},xe=e=>{const t=new Image;t.src=e},Ie=async(e,t)=>{var n;console.log("通信エラー:",e);try{const o=(n=t==null?void 0:t.headers)==null?void 0:n.get("Content-Type");o&&o.includes("application/json")?(console.log("サーバーレスポンス:",await t.json()),alert(`モーダルの読み込みに失敗しました。
`+e.message)):console.log("サーバーレスポンス:",await t.text())}catch(o){console.error("エラー内容の解析中に失敗しました:",o)}},h=async(e,t="GET",n=null,o={})=>{const s=await fetch(e,{method:t,body:n,...o});try{if(!s.ok)throw new Error(`APIエラー: ${s.status}`);const a=s.headers.get("Content-Type");return a&&a.includes("application/json")?await s.json():await s.text()}catch(a){return await Ie(a,s),{success:!1,message:"通信エラーが発生しました。"}}},oe=async e=>h(g(`/index.php?modal=${e}`)),qe=async e=>h(g("/index.php?modal=login"),"POST",e),Te=async e=>h(g("/index.php?modal=register"),"POST",e),Me=async()=>h(g("/api/chart_data.php")),Y=e=>{const t=e.closest("[data-date]");return t?t.dataset.date:null};let M={};const se=async e=>{const t=Y(e);if(!t)return null;if(M[t])return M[t];const n=await h(g(`/api/record_data.php?date=${t}`));return n&&n.date?(M[t]=n,M[t]):null},Ce=async e=>h(g("/index.php?modal=recordAdmin"),"POST",e),Re=async e=>h(g("/index.php?modal=record"),"POST",e),Be=async e=>h(g("/index.php?modal=recordDelete"),"POST",e),Fe=async e=>h(g("/index.php?modal=recordReset"),"POST",e);let C=null;const Oe=async()=>{if(C)return C;const e=await h(g("/api/user_data.php"));return e&&e.username?(C=e,C):null},Pe=async e=>h(g("/index.php?modal=adminUser"),"POST",e),$e=async e=>h(g("/index.php?modal=adminAccount"),"POST",e),je=async e=>h(g("/index.php?modal=accountDelete"),"POST",e),Ne=()=>{document.querySelector(".account-delete")&&document.getElementById("acc-delete-btn").addEventListener("click",async n=>{n.preventDefault();const o=await je();window.history.scrollRestoration="manual",window.location.reload(),o.success||alert(o.message)})},Ue=Object.freeze(Object.defineProperty({__proto__:null,init:Ne},Symbol.toStringTag,{value:"Module"})),ee=new WeakSet,P=new WeakSet,Q=(e,t)=>{document.querySelectorAll(e).forEach(o=>{if(ee.has(o))return;ee.add(o);const s=i=>{const c=i.target;P.has(c)||i.isComposing===!0||t(c)},a=i=>{P.add(i.target)},r=i=>{const c=i.target;P.delete(c),t(c)};o.addEventListener("input",s),o.addEventListener("change",s),o.addEventListener("compositionstart",a),o.addEventListener("compositionend",r),o.addEventListener("compositioncancel",r)})},B=(e,t)=>{const n=e.value;if(t===n)return;const o=typeof e.selectionStart=="number"&&typeof e.selectionEnd=="number",s=o?e.selectionStart:null,a=o?e.selectionEnd:null,r=o&&s===n.length&&a===n.length;if(e.value=t,!o)return;if(r){e.selectionStart=e.selectionEnd=t.length;return}const i=t.length-n.length,c=Math.max(0,Math.min(t.length,(s??0)+i)),d=Math.max(0,Math.min(t.length,(a??0)+i));e.selectionStart=c,e.selectionEnd=d},J=e=>{Q(e,t=>{const n=t.value.replace(/[^a-zA-Z0-9 !"#$%&'()*+,-./:;<=>?@[\\\]^_`{|}~]/g,"");B(t,n)})},He=e=>{Q(e,t=>{const n=t.value.replace(/[^0-9]/g,"");B(t,n)})},k=e=>{Q(e,t=>{let n=t.value;n=n.replace(/[^0-9.]/g,"");const o=n.indexOf(".");o!==-1&&(n=n.slice(0,o+1)+n.slice(o+1).replace(/\./g,""));const s=parseFloat(n);if(!isNaN(s)&&s>999.9){B(t,"999.9");return}const[a="",r=""]=n.split("."),i=a.slice(0,3),c=r.slice(0,1);n=c!==""||n.includes(".")?`${i}.${c}`:i,B(t,n)})},Ve=async()=>{const e=document.getElementById("login-form");y(e),q(e),I(e),J("input[data-alphanumeric]"),He("input[data-numeric]"),e&&e.addEventListener("submit",async t=>{if(t.preventDefault(),x(e),!A(e)){console.log("バリデーションエラー： フォーム送信をキャンセル");return}const o=new FormData(e),s=await qe(o),a=document.querySelector(".form-message");s.success?window.location.href=g("/home"):(a.classList.add("error"),a.innerHTML=`ログインに失敗しました。<br>${s.errorMessage}`,a.style.display="block")})},We=Object.freeze(Object.defineProperty({__proto__:null,init:Ve},Symbol.toStringTag,{value:"Module"})),ae=()=>{const e=document.getElementById("step1"),t=document.getElementById("step2");if(!e||!t)return;const n=document.querySelectorAll(".btn--go-to-step2, #btn--go-to-step2"),o=document.getElementById("btn--back-to-step1"),s=r=>{r.preventDefault(),ze(e,t)},a=r=>{r.preventDefault(),Ge(e,t)};n.forEach(r=>r.addEventListener("click",s)),o.addEventListener("click",a)},ze=(e,t)=>{e.classList.add("hidden"),e.classList.remove("visible"),t.classList.add("visible"),t.classList.remove("hidden")},Ge=(e,t)=>{t.classList.add("hidden"),t.classList.remove("visible"),e.classList.add("visible"),e.classList.remove("hidden")},Ye=()=>{ae();const e=document.querySelectorAll(".notice-contents"),t=document.querySelectorAll(".notice-detail"),n=s=>{t.forEach(a=>{a.classList.toggle("visible",a.id===s),a.classList.toggle("hidden",a.id!==s)})};e.forEach(s=>{s.addEventListener("click",()=>{n(s.dataset.notice)})});const o=document.querySelector("#header__notifications span");o.dataset.icon="notifications"},Qe=Object.freeze(Object.defineProperty({__proto__:null,init:Ye},Symbol.toStringTag,{value:"Module"})),Je=e=>{const t=document.querySelector(".modal-record-admin"),n=document.getElementById("record-form");if(I(n),q(n),k("input[data-weight-input]"),e){const o=e.date.replace(/-/g,"/");t.querySelector(".date__contents").textContent=o,t.querySelector("#recorded_at").value=o,t.querySelector("#weight").value=e.weight,t.querySelector("#memo").value=e.memo||""}y(n),document.addEventListener("input",y(n)),document.addEventListener("change",y(n)),n&&(n.addEventListener("submit",async s=>{if(s.preventDefault(),x(n),!A(n)){console.log("バリデーションエラー： フォーム送信をキャンセル");return}const r=new FormData(n),i=await Ce(r);window.history.scrollRestoration="manual",window.location.reload(),i.success||alert(i.message)}),document.getElementById("delete-btn").addEventListener("click",async s=>{s.preventDefault();const a=new FormData(n),r=await Be(a);window.history.scrollRestoration="manual",window.location.reload(),r.success||alert(r.message)}))},Xe=Object.freeze(Object.defineProperty({__proto__:null,init:Je},Symbol.toStringTag,{value:"Module"})),Ke=()=>{document.querySelector(".record-reset")&&document.getElementById("reset-btn").addEventListener("click",async n=>{n.preventDefault();const o=await Fe();window.history.scrollRestoration="manual",window.location.reload(),o.success||alert(o.message)})},Ze=Object.freeze(Object.defineProperty({__proto__:null,init:Ke},Symbol.toStringTag,{value:"Module"})),et=()=>{const e=document.getElementById("date-contents"),t=document.getElementById("date-prev"),n=document.getElementById("date-next"),o=document.getElementById("recorded_at");if(!e&&!o&&!t&&!n)return;const s={dateContents:e,inputRecordedAt:o,dateNextBtn:n},a=tt();let r={selectedDate:a,today:a};r=$(r,"init"),j(s,r),t&&t.addEventListener("click",()=>{r=$(r,"prev"),j(s,r)}),n&&n.addEventListener("click",()=>{r=$(r,"next"),j(s,r)})},tt=()=>{const e=new Date,n=new Intl.DateTimeFormat("ja-JP",{timeZone:"Asia/Tokyo",year:"numeric",month:"2-digit",day:"2-digit"}).formatToParts(e),o=n.find(r=>r.type==="year").value,s=n.find(r=>r.type==="month").value,a=n.find(r=>r.type==="day").value;return new Date(`${o}-${s}-${a}T00:00:00+09:00`)},nt=e=>{const t=a=>("0"+a).slice(-2),n=e.getFullYear().toString(),o=t(e.getMonth()+1).toString(),s=t(e.getDate()).toString();return`${n}/${o}/${s}`},$=(e,t)=>{let{today:n}=e;const o=new Date(e.selectedDate);t==="prev"?o.setDate(o.getDate()-1):t==="next"&&o.getTime()<n.getTime()&&o.setDate(o.getDate()+1);const s=nt(o),a=o.getTime()<n.getTime();return{selectedDate:o,today:n,display:s,canGoNext:a}},j=(e,t)=>{const{dateContents:n,inputRecordedAt:o,dateNextBtn:s}=e;n&&(n.textContent=t.display),o&&(o.value=t.display),s&&(s.disabled=!t.canGoNext)},ot=async()=>{const e=document.getElementById("record-form");et(),I(e),q(e),k("input[data-weight-input]"),y(e),document.addEventListener("input",y(e)),document.addEventListener("change",y(e)),e&&e.addEventListener("submit",async t=>{if(t.preventDefault(),x(e),!A(e)){console.log("バリデーションエラー： フォーム送信をキャンセル");return}const o=new FormData(e),s=await Re(o);window.history.scrollRestoration="manual",window.location.reload(),s.success||alert(s.message)})},st=Object.freeze(Object.defineProperty({__proto__:null,init:ot},Symbol.toStringTag,{value:"Module"})),re=()=>{const e=document.getElementById("birth-year"),t=document.getElementById("birth-month"),n=document.getElementById("birth-day");if(!e||!t||!n)return;if(e.options.length<=1){const a=new Date().getFullYear();for(let r=a;r>=a-100;r--){let i=document.createElement("option");i.value=String(r),i.textContent=String(r),e.appendChild(i)}}const o=a=>a!==""&&Number.isFinite(+a)?+a:null,s=()=>{const a=o(e.value),r=o(t.value),i=o(n.value),c=at(a,r,i);rt({yearSelect:e,monthSelect:t,daySelect:n},c)};e.addEventListener("change",s),t.addEventListener("change",s),requestAnimationFrame(s)},at=(e,t,n)=>{const o=e==null,s=e==null||t==null;let a=null;s||(a=new Date(e,t,0).getDate());let r=null;return n!=null&&a!=null&&(r=Math.min(n,a)),{monthDisabled:o,dayDisabled:s,maxDay:a,nextDayValue:r}},rt=({yearSelect:e,monthSelect:t,daySelect:n},o)=>{const{monthDisabled:s,dayDisabled:a,maxDay:r,nextDayValue:i}=o;for(t.disabled=s,n.disabled=a;n.options.length>1;)n.remove(1);if(r!=null)for(let c=1;c<=r;c++){const d=document.createElement("option");d.value=String(c),d.textContent=String(c),n.appendChild(d)}i!=null?(n.value=String(i),n.value!==String(i)&&r!=null&&(n.value=String(r))):n.value=""},it=()=>{const e=document.getElementById("register-form");re(),I(e),y(e),q(e),J("input[data-alphanumeric]"),k("input[data-height-input]"),k("input[data-weight-input]"),ae(),e&&e.addEventListener("submit",async t=>{if(t.preventDefault(),x(e),!A(e)){console.log("バリデーションエラー： フォーム送信をキャンセル");return}const o=new FormData(e),s=await Te(o),a=document.querySelector(".form-message");s.success?(sessionStorage.setItem("accountCreated","true"),window.location.href=g("/home")):(a.classList.add("error"),a.innerHTML=`新規登録に失敗しました。<br>${s.errorMessage}`,a.style.display="block")})},ct=Object.freeze(Object.defineProperty({__proto__:null,init:it},Symbol.toStringTag,{value:"Module"})),lt=e=>{const t=document.querySelector("#user-info-form");re(),I(t),q(t),J("input[data-alphanumeric]"),k("input[data-height-input]"),k("input[data-weight-input]");const n=document.querySelector(".admin-account-form"),o=document.querySelector(".admin-user-form"),s=document.querySelector(".modal");if(e){s.querySelector("#username").value=e.username,s.querySelector("#birth-year").value=e.birth_year,s.querySelector("#birth-month").value=e.birth_month,requestAnimationFrame(()=>{s.querySelector("#birth-day").value=e.birth_day});const a=document.querySelector(`input[name="gender"][value="${e.gender}`);a.checked=!0,s.querySelector("#height").value=e.height,s.querySelector("#ideal-weight").value=e.ideal_weight}y(t),document.addEventListener("input",y(t)),document.addEventListener("change",y(t)),t&&t.addEventListener("submit",async a=>{if(a.preventDefault(),x(t),!A(t)){console.log("バリデーションエラー： フォーム送信をキャンセル");return}const i=new FormData(t);let c;n&&(c=await $e(i)),o&&(c=await Pe(i)),window.history.scrollRestoration="manual",window.location.reload(),c.success||alert(c.message)})},dt=Object.freeze(Object.defineProperty({__proto__:null,init:lt},Symbol.toStringTag,{value:"Module"})),ut="visibility",mt="visibility_off",ft="パスワードを表示",gt="パスワードを非表示",pt=()=>{const e=document.querySelectorAll(".pwd-btn");e.length&&e.forEach(t=>{if(t.dataset.inited==="1")return;t.dataset.inited="1",le(t);const n=()=>ht(t);t.addEventListener("click",n)})},ht=e=>{const t=ie(e);t&&(yt(e,!ce(e)),le(e,t))},ie=e=>{const t=e.previousElementSibling;return t&&t.tagName.toLowerCase()==="input"?t:null},yt=(e,t)=>e.dataset.hidden=String(t),ce=e=>e.dataset.hidden==="true",le=(e,t=ie(e))=>{if(!t)return;const n=ce(e);vt(t,n),bt(e,n),St(e,t,n)},vt=(e,t)=>{e.type=t?"password":"text"},bt=(e,t)=>{const n=e.querySelector("[data-icon]");n&&(n.dataset.icon=t?ut:mt)},St=(e,t,n)=>{t.id&&e.setAttribute("aria-controls",t.id),e.setAttribute("aria-pressed",String(!n)),e.setAttribute("aria-label",Et(n))},Et=e=>e?ft:gt,de=document.querySelector("body"),_t=document.getElementById("layout");let N=!1;const V=new Map,_=new Map,wt=(e,t)=>{const n={record:"./init/record.js",recordAdmin:"./init/record-admin.js",recordReset:"./init/record-reset.js",adminAccount:"./init/user-info.js",adminUser:"./init/user-info.js",login:"./init/login.js",register:"./init/register.js",accountCreated:"./init/account-created.js",accountDelete:"./init/account-delete.js",notifications:"./init/notifications.js"},o=Object.assign({"./init/account-created.js":Ae,"./init/account-delete.js":Ue,"./init/login.js":We,"./init/notifications.js":Qe,"./init/record-admin.js":Xe,"./init/record-reset.js":Ze,"./init/record.js":st,"./init/register.js":ct,"./init/user-info.js":dt}),s=n[e],a=o[s];s&&typeof a.init=="function"&&a.init(t)},te=async(e,t=null)=>{const n=e;let o=e,s=null;if(e==="recordAdmin"&&t){const r=Y(t);if(!r)return;o=`recordAdmin-${r}`,_.has(o)||(s=await se(t),_.set(o,s))}if(e==="adminUser"&&!_.has(o)&&(s=await Oe(),_.set(o,s)),e==="record"&&xe("/images/date-arrow.svg"),V.has(n))return;const a=await oe(e);V.set(n,a)},X=async(e,t=null)=>{if(N)return;N=!0;const n=V.get(e)||await oe(e),o=t?_.get(t):null;_t.insertAdjacentHTML("afterend",n),de.style.overflow="hidden",pt(),wt(e,o),document.querySelectorAll(".close-modal").forEach(a=>{a&&a.addEventListener("click",ue)}),N=!1},ue=()=>{const e=document.getElementById("modal");e&&(e.remove(),de.style.overflow="")},me=document.querySelectorAll("[data-modal]");me.forEach(e=>{e.addEventListener("click",async()=>{const t=e.getAttribute("data-modal");let n=t;if(t==="recordAdmin"){const o=Y(e);o&&(n=`recordAdmin-${o}`)}if(!_.has(n)){const o=await se(e);_.set(n,o)}X(t,n)})});document.addEventListener("click",e=>{const t=document.querySelector("#modal.record, #modal.recordAdmin");t&&e.target===t&&ue()});const fe=new Set;me.forEach(e=>{const t=e.getAttribute("data-modal");fe.add(t)});const Lt=document.querySelectorAll('[data-modal="recordAdmin"]');window.addEventListener("load",()=>{setTimeout(async()=>{const e=[...fe].map(t=>te(t));await Promise.all(e);for(const t of Lt)await te("recordAdmin",t)},1e3)});sessionStorage.getItem("accountCreated")==="true"&&(X("accountCreated"),sessionStorage.removeItem("accountCreated"));showIdModal&&X("idCheck");const Dt=()=>{const e=document.getElementById("header");if(!e)return;const t=e.offsetHeight;let n=0;window.addEventListener("load",()=>{window.addEventListener("scroll",()=>{const i=window.scrollY||document.documentElement.scrollTop;i>n&&i>t?e.style.top=`-${t}px`:e.style.top="0",n=i})});const o=document.getElementById("menu-toggle"),s=document.querySelector(".layout__sidebar");o.addEventListener("click",()=>{s.classList.contains("open")?(s.classList.remove("open"),s.classList.add("close")):(s.classList.remove("close"),s.classList.add("open"))});const a=window.matchMedia("(max-width: 1299px)"),r=i=>{i.matches?(s.classList.remove("open"),s.classList.add("close")):(s.classList.remove("close"),s.classList.add("open"))};r(a),a.addEventListener("change",r),document.addEventListener("click",i=>{i.target.closest(".layout__sidebar")||a.matches&&(s.classList.remove("open"),s.classList.add("close"))})},kt=()=>{const e=document.querySelectorAll(".accordion-btn");e.length&&e.forEach((t,n)=>{At(t,n),t.addEventListener("click",()=>xt(t))})},At=(e,t)=>{const n=e.closest(".accordion"),o=n==null?void 0:n.querySelector(".accordion-content");if(!n||!o)return;const s=`accordion-btn-${t+1}`,a=`accordion-panel-${t+1}`;e.id=s,e.setAttribute("aria-controls",a),e.setAttribute("aria-expanded","false"),o.id=a,o.setAttribute("role","region"),o.setAttribute("aria-labelledby",s),o.hidden=!0,o.style.maxHeight="0",n.setAttribute("data-state","close")},xt=e=>{const t=e.closest(".accordion"),n=t==null?void 0:t.querySelector(".accordion-content");if(!t||!n)return;t.getAttribute("data-state")==="open"?qt(t,e,n):It(t,e,n)},It=(e,t,n)=>{n.hidden=!1,n.style.maxHeight="0",requestAnimationFrame(()=>{n.style.maxHeight=n.scrollHeight+"px"}),t.setAttribute("aria-expanded","true"),e.setAttribute("data-state","open")},qt=(e,t,n)=>{n.style.maxHeight=n.scrollHeight+"px",requestAnimationFrame(()=>{n.style.maxHeight="0"});const o=s=>{s.propertyName==="max-height"&&(n.hidden=!0,n.removeEventListener("transitionend",o))};n.addEventListener("transitionend",o),t.setAttribute("aria-expanded","false"),e.setAttribute("data-state","close")},Tt=()=>{const e=document.getElementById("header__info"),t=document.getElementById("header__profile"),n=document.getElementById("user-popup");!e||!t||!n||(Mt(t,n),t.addEventListener("click",o=>{o.stopPropagation(),Ct(e,t)}),document.addEventListener("click",o=>{n.contains(o.target)||ge(e,t)}))},Mt=(e,t)=>{e.setAttribute("aria-controls",t.id),e.setAttribute("aria-expanded","false")},Ct=(e,t)=>{e.classList.contains("click")?ge(e,t):Rt(e,t)},Rt=(e,t)=>{e.classList.add("click"),t.setAttribute("aria-expanded","true")},ge=(e,t)=>{e.classList.remove("click"),t.setAttribute("aria-expanded","false")},Bt="IDをコピーしました。",W="copy-dialog",Ft=10,Ot=1500,Pt=2e3,$t=(e=document,{message:t=Bt}={})=>{const n=async o=>{const s=o.target.closest(".copy-link");if(!s)return;const a=s.closest(".copy-contents"),r=a==null?void 0:a.querySelector(".copy__value");if(r&&!document.querySelector(`.${W}`))try{await navigator.clipboard.writeText(r.textContent),jt(t)}catch{}};e.addEventListener("click",n)},jt=e=>{const t=Nt();Ut(t,e)},Nt=()=>{let e=document.querySelector(`.${W}`);return e||(e=document.createElement("div"),e.classList.add(W),e.setAttribute("role","status"),e.setAttribute("aria-live","polite"),e.setAttribute("aria-atomic","true"),document.body.appendChild(e)),e},Ut=(e,t)=>{e.textContent=t,setTimeout(()=>e.classList.add("show"),Ft),setTimeout(()=>e.classList.remove("show"),Ot),setTimeout(()=>e.remove(),Pt)},Ht=()=>{const e=document.querySelector(".weight-days__blocks"),t=document.querySelector(".weight-days .btn--more"),n=[...document.querySelectorAll(".weight-days__switch button")],o={parent:e,btnMore:t,switchBtns:n},s=[...document.querySelectorAll(".weight-days__block")];if(!e||!s.length)return;const a=s.map(d=>({el:d,dateStr:d.querySelector(".weight-days__date").textContent.trim()})),r=6,i={sort:"new",showNum:r};let c=U(a,i);H(o,a,c),t&&t.addEventListener("click",()=>{i.showNum+=r,c=U(a,i),H(o,a,c)}),n.forEach(d=>{d.addEventListener("click",()=>{i.sort=d.dataset.sort==="old"?"old":"new",c=U(a,i),H(o,a,c)})})},U=(e,t)=>{const{sort:n,showNum:o}=t,s=d=>e[d].dateStr.trim(),a=e.map((d,l)=>l).sort((d,l)=>n==="old"?s(d).localeCompare(s(l)):s(l).localeCompare(s(d))),r=Math.min(o,e.length),i=r<e.length;return{order:a,visibleCount:r,canShowMore:i,selectedSort:n}},H=(e,t,n)=>{const{parent:o,btnMore:s,switchBtns:a}=e,{order:r,visibleCount:i,canShowMore:c,selectedSort:d}=n;if(!o)return;const l=new DocumentFragment;r.forEach((f,b)=>{const p=t[f].el;b<i?p.classList.add("show"):p.classList.remove("show"),l.appendChild(p)}),o.innerHTML="",o.appendChild(l),c||s.classList.add("hide"),a&&a.length&&a.forEach(f=>{f.classList.toggle("btn--select",f.dataset.sort===d)})},Vt=async()=>{const e=document.getElementById("graph");if(!e)return;const t=new Date,n=await Me(),o=n.chart_arr,s=n.ideal_weight;Chart.register(window["chartjs-plugin-annotation"]);const a=window.matchMedia("(max-width: 599px)");let r;const i=()=>{r=Yt(l,{today:t,weightRecords:o,graphElement:e,weightChart:r,mediaQueryChart:a,idealWeight:s})},c=()=>{const p=Gt(l,{today:t,weightRecords:o});Qt(b,p)},d=document.querySelector(".weight-graph__date");let l="1m";i(),D(l,{today:t,weightGraphDate:d}),a.addEventListener("change",()=>i());const f=document.querySelectorAll(".weight-graph__switch button"),b=document.querySelectorAll(".weight-summary__block");f.length<1||(f.forEach(p=>{p.addEventListener("click",()=>{var S;(S=document.querySelector(".weight-graph__switch .btn--select"))==null||S.classList.remove("btn--select"),p.classList.add("btn--select")})}),c(),document.getElementById("weight-graph__week").addEventListener("click",()=>{l="7d",i(),D(l,{today:t,weightGraphDate:d}),c()}),document.getElementById("weight-graph__month").addEventListener("click",()=>{l="1m",i(),D(l,{today:t,weightGraphDate:d}),c()}),document.getElementById("weight-graph__three-month").addEventListener("click",()=>{l="3m",i(),D(l,{today:t,weightGraphDate:d}),c()}),document.getElementById("weight-graph__half-year").addEventListener("click",()=>{l="6m",i(),D(l,{today:t,weightGraphDate:d}),c()}),document.getElementById("weight-graph__year").addEventListener("click",()=>{l="1y",i(),D(l,{today:t,weightGraphDate:d}),c()}))},R=e=>new Date(e.getTime()),F=(e,{today:t,isPrev:n=!1})=>{const o=R(t);o.setHours(0,0,0,0);let s=R(o);s.setDate(o.getDate()+1);let a=R(s);const r={"7d":[7,14],"1m":[1,2],"3m":[3,6],"6m":[6,12],"1y":[12,24]};if(e==="7d"){const l=r[e][0];n&&(s.setDate(s.getDate()-l),a=new Date(s.getTime())),a.setDate(s.getDate()-l)}else{const l=r[e][0];n&&(s.setMonth(s.getMonth()-l),a=new Date(s.getTime())),a.setMonth(s.getMonth()-l)}const i=l=>`${l.getFullYear()}-${String(l.getMonth()+1).padStart(2,"0")}-${String(l.getDate()).padStart(2,"0")}`;let c=[],d=R(a);for(;d<s;)c.push(i(d)),d.setDate(d.getDate()+1);return c},z=(e,t)=>{const n=Object.fromEntries(e.map(c=>[c.date,c.weight])),o=Object.fromEntries(e.map(c=>[c.date,c.bmi])),s=Object.fromEntries(e.map(c=>[c.date,c.bfp])),a=t.map(c=>n[c]??null),r=t.map(c=>o[c]??null),i=t.map(c=>s[c]??null);return{labels:t,dataset:a,bmi:r,bfp:i}},Wt=(e,t,n)=>{if(!t.length)return e.slice();const o=Math.ceil(t.length/n);let s=0;return e.map((a,r,i)=>{const c=i.length-1,d=c-r;if(r===c||d%o===0){const f=e.slice(s,r+1).filter(S=>S),b=f.reduce((S,u)=>parseFloat(S)+parseFloat(u),0);return s=r+1,b?(b/f.length).toFixed(1):null}else return null})},zt=(e,t)=>{const n=F(e,{today:t}).map(a=>a.replaceAll("-","/"));if(!n.length)return"--";const o=n[0],s=n[n.length-1];return`${o}～${s}`},Gt=(e,{today:t,weightRecords:n})=>{const o=F(e,{today:t,isPrev:!1}),s=F(e,{today:t,isPrev:!0}),a=z(n,o),r=a.dataset.filter(m=>m!==null),i=a.bmi.filter(m=>m!==null),c=a.bfp.filter(m=>m!==null),l=z(n,s).dataset.filter(m=>m!==null),f=(m,E=1)=>{const v=m.filter(L=>L!=null).map(L=>parseFloat(L.replace(/,/g,"")));return v.length?(v.reduce((L,pe)=>L+pe,0)/v.length).toFixed(E):null},b=(m,E)=>{if(m.length&&E.length){const v=(f(m)-f(E)).toFixed(1);return v>0?"+"+v:String(v)}else return null},p=m=>m.length?Math.max(...m).toFixed(1):null,S=m=>m.length?Math.min(...m).toFixed(1):null;let u;return e==="7d"&&(u="1週間"),e==="1m"&&(u="1ヶ月"),e==="3m"&&(u="3ヶ月"),e==="6m"&&(u="半年"),e==="1y"&&(u="1年"),{rangeText:u,average:f(r),bfp:f(c,2),bmi:f(i,2),in_de:b(r,l),best:p(r),lowest:S(r)}},Yt=(e,{today:t,weightRecords:n,graphElement:o,weightChart:s,mediaQueryChart:a,idealWeight:r})=>{const i=F(e,{today:t,isPrev:!1}),{labels:c,dataset:d}=z(n,i);s&&s.destroy();const l=Chart.getChart(o);l&&l.destroy();const f=a.matches?12:31,b=Wt(d,c,f),p=c.map(u=>u.replaceAll("-","/")),S=o.getContext("2d");if(s=new Chart(S,{type:"line",data:{labels:p,datasets:[{label:"体重（kg）",data:b,backgroundColor:"#4a90e2",borderColor:"#4a90e2",borderWidth:2,pointRadius:4,pointBackgroundColor:"#fff",pointBorderColor:"#4a90e2",pointBorderWidth:3,hoverBorderWidth:4,pointHoverRadius:6,spanGaps:!0}]},options:{responsive:!0,maintainAspectRatio:!0,aspectRatio:a.matches?4/3:2/1,animation:{duration:800},animations:{y:{from(u){if(u.type==="data"&&u.mode==="default"&&u.parsed.y!=null){const m=u.chart.scales.y;return m.getPixelForValue(m.min)}}}},scales:{x:{ticks:{autoSkip:!0,callback(u){return c[u]?`${new Date(c[u]).getDate()}日`:""},maxRotation:0,minRotation:0,maxTicksLimit:15}},y:{suggestedMax:Math.max(...d.filter(u=>u!=null).map(Number))+1,suggestedMin:r-1,ticks:{maxTicksLimit:a.matches?6:8}}},plugins:{legend:{display:!1},tooltip:{titleFont:{size:a.matches?10:12,family:"Inter, Noto Sans JP, sans-serif"},bodyFont:{size:a.matches?12:14,family:"Inter, Noto Sans JP, sans-serif"},callbacks:{label(u){return` 体重: ${u.raw} kg`}}},annotation:{annotations:{goalLine:{type:"line",yMin:r,yMax:r,borderColor:"#e65100",borderWidth:2,borderDash:[6,6],label:{content:"目標体重",enabled:!0,position:"end"}}}}}}}),e==="3m"||e==="6m"||e==="1y"){let u=null;s.options.scales.x.ticks.callback=m=>{let E=new Date(c[m]),v=E.getMonth()+1,K=E.getDate();if(!(v===u||K!==1))return u=v,`${v}月`},s.update()}return s},D=(e,{today:t,weightGraphDate:n})=>{n.textContent=zt(e,t)},Qt=(e,t)=>{e.forEach(n=>{const o=n.querySelector(".period");o&&(o.textContent=t.rangeText??"--");const s=n.dataset.summary,a=t[s],r=n.querySelector(".weight-summary__num");r&&(r.textContent=a??"--")})};document.querySelector("#header")&&Dt();document.querySelector(".accordion")&&kt();document.querySelector("#header__info")&&Tt();$t();document.querySelector(".weight-days__blocks")&&Ht();document.querySelector("#graph")&&Vt();
