const B={REQUIRED:"required",TOO_SHORT:"too_short"},X=(e,{root:t}={})=>{if(e.disabled)return{ok:!0};if(e.type==="radio")return ve(e,{root:t});if(e.type==="checkbox")return Ee(e);const n=(e.value??"").trim();return e.id==="password"?be(n):e.tagName==="SELECT"?_e(e):e.tagName==="INPUT"||e.tagName==="TEXTAREA"?we(e,n):{ok:!0}},ve=(e,{root:t}={})=>{const n=t??e.form??document,o=Array.from(n.querySelectorAll(`input[type="radio"][name="${e.name}"]`));return o.length===0?e.required&&!e.checked?{ok:!1,code:B.REQUIRED}:{ok:!0}:o.some(i=>i.required)?o.some(i=>i.checked)?{ok:!0}:{ok:!1,code:B.REQUIRED}:{ok:!0}},Ee=e=>e.required&&!e.checked?{ok:!1,code:B.REQUIRED}:{ok:!0},be=e=>e===""?{ok:!1,code:B.REQUIRED}:e.length<4?{ok:!1,code:B.TOO_SHORT,payload:{min:4}}:{ok:!0},_e=e=>e.required&&(e.value===""||e.selectedIndex===-1)?{ok:!1,code:B.REQUIRED}:{ok:!0},we=(e,t)=>e.required&&t===""?{ok:!1,code:B.REQUIRED}:{ok:!0},Se={required:e=>`${e}を入力してください`,too_short:(e,t)=>`${e}は${(t==null?void 0:t.min)??4}文字以上で入力してください`},Le=e=>{const t=e.querySelector(".label-title, .label-name"),n=(t==null?void 0:t.textContent.trim())??"";return n.includes("（")?n.substring(0,n.indexOf("（")):n},se=(e,t)=>{if(!e||!t)return;const n="validate-form__input";let o=null;if(e.classList&&e.classList.contains(n)&&(o=e),!o&&e.querySelector){const i=e.querySelector(`.${n}`);i&&(o=i)}if(!o&&e.closest){const i=e.querySelector(`.${n}`);i&&(o=i)}o||(o=e);const s=o.querySelector(".validate-text")||o.nextElementSibling;if(!s)return;const a=Le(o);if(t.ok)s.textContent="",o.classList.remove("no-text"),o.removeAttribute("aria-invalid");else{const r=(Se[t.code]||(()=>""))(a,t.payload);s.textContent=r,o.classList.add("no-text"),o.setAttribute("aria-invalid","true")}},H=new WeakMap,De=(e=document)=>{if(H.has(e))return H.get(e);const t=s=>{const a=s.target.closest("input, select, textarea");if(!a||!e.contains(a))return;const i=a.closest(".validate-form__input");i&&(i.classList.add("click"),a&&(a.tagName==="INPUT"||a.tagName==="TEXTAREA")&&i.classList.add("text-on"))},n=s=>{s.target.closest("input, select, textarea")||e.querySelectorAll(".validate-form__input.click").forEach(a=>{const i=a.querySelector("input, textarea, select");a.classList.remove("click"),i&&(i.tagName==="INPUT"||i.tagName==="TEXTAREA")&&(i.value??"").trim()===""&&a.classList.remove("text-on")})};e.addEventListener("click",t),document.addEventListener("click",n);const o=()=>{e.removeEventListener("click",t),document.removeEventListener("click",n),H.delete(e)};return H.set(e,o),o},F=e=>{if(!e)return;e.querySelectorAll(".validate-form__input").forEach(n=>{n.querySelectorAll("input, select, textarea").forEach(s=>{ke(s,n,e)})})},ke=(e,t,n)=>{const o=X(e,{root:n});return se(t,o),o.ok},j=e=>{if(!e)return!1;const n=e.querySelector(".step.visible")||e,s=[...n.querySelectorAll("[required]")].every(i=>X(i,{root:n}).ok);return e.querySelectorAll(".submit-btn").forEach(i=>{s?i.classList.remove("disabled"):i.classList.add("disabled"),i.disabled=!s}),s},w=e=>{if(!e)return;const t=()=>j(e);t(),e.addEventListener("input",t),e.addEventListener("change",t),e.querySelectorAll(".next-btn, .prev-btn").forEach(n=>{n.addEventListener("click",t)})},$=e=>{e&&De(e)},G=new WeakMap,Ae=e=>{if(!e)return;G.has(e)||G.set(e,new WeakSet);const t=G.get(e);e.addEventListener("click",n=>{var s;const o=(s=n.target)==null?void 0:s.closest("input, select, textarea");!o||!e.contains(o)||t.has(o)||(Ie(o,e),t.add(o))})},Ie=(e,t)=>{if(!e||e.disabled)return;const n=e.tagName==="SELECT",o=e.type==="radio"||e.type==="checkbox",s=n||o?"change":"input",a=()=>{const i=(t==null?void 0:t.querySelector(".step.visible"))??t??e.form??document,r=e.closest(".validate-form__input"),c=X(e,{root:i});se(r,c)};e.addEventListener(s,a),a()},qe=()=>{const e=document.querySelector(".basic-info-form");w(e),e&&e.addEventListener("submit",t=>{t.preventDefault()})},Te=Object.freeze(Object.defineProperty({__proto__:null,init:qe},Symbol.toStringTag,{value:"Module"})),E=e=>{const t=e.replace(/^\/+/,"");return`${BASE_PATH}${t}`},xe=e=>{const t=new Image;t.src=e},Me=async(e,t)=>{var n;console.log("通信エラー:",e);try{const o=(n=t==null?void 0:t.headers)==null?void 0:n.get("Content-Type");o&&o.includes("application/json")?(console.log("サーバーレスポンス:",await t.json()),alert(`モーダルの読み込みに失敗しました。
`+e.message)):console.log("サーバーレスポンス:",await t.text())}catch(o){console.error("エラー内容の解析中に失敗しました:",o)}},b=async(e,t="GET",n=null,o={})=>{const s=await fetch(e,{method:t,body:n,...o});try{if(!s.ok)throw new Error(`APIエラー: ${s.status}`);const a=s.headers.get("Content-Type");return a&&a.includes("application/json")?await s.json():await s.text()}catch(a){return await Me(a,s),{success:!1,message:"通信エラーが発生しました。"}}},ae=async e=>b(E(`/index.php?modal=${e}`)),Be=async e=>b(E("/index.php?modal=login"),"POST",e),Ce=async e=>b(E("/index.php?modal=register"),"POST",e),Re=async()=>b(E("/api/chart_data.php")),K=e=>{const t=e.closest("[data-date]");return t?t.dataset.date:null};let U={};const ie=async e=>{const t=K(e);if(!t)return null;if(U[t])return U[t];const n=await b(E(`/api/record_data.php?date=${t}`));return n&&n.date?(U[t]=n,U[t]):null},Oe=async e=>b(E("/index.php?modal=recordAdmin"),"POST",e),je=async e=>b(E("/index.php?modal=record"),"POST",e),Fe=async e=>b(E("/index.php?modal=recordDelete"),"POST",e),$e=async e=>b(E("/index.php?modal=recordReset"),"POST",e);let N=null;const Pe=async()=>{if(N)return N;const e=await b(E("/api/user_data.php"));return e&&e.username?(N=e,N):null},He=async e=>b(E("/index.php?modal=adminUser"),"POST",e),Ue=async e=>b(E("/index.php?modal=adminAccount"),"POST",e),Ne=async e=>b(E("/index.php?modal=accountDelete"),"POST",e),Ve=()=>{document.querySelector(".account-delete")&&document.getElementById("acc-delete-btn").addEventListener("click",async n=>{n.preventDefault();const o=await Ne();window.history.scrollRestoration="manual",window.location.reload(),o.success||alert(o.message)})},We=Object.freeze(Object.defineProperty({__proto__:null,init:Ve},Symbol.toStringTag,{value:"Module"})),Z=e=>{document.querySelectorAll(e).forEach(t=>{t.addEventListener("input",n=>{n.target.value=n.target.value.replace(/[^a-zA-Z0-9 !"#$%&'()*+,-./:;<=>?@[\\\]^_`{|}~]/g,"")})})},ze=e=>{document.querySelectorAll(e).forEach(t=>{t.addEventListener("input",n=>{n.target.value=n.target.value.replace(/[^0-9]/g,"")})})},O=e=>{document.querySelectorAll(e).forEach(t=>{t.addEventListener("input",()=>{let n=t.value;n=n.replace(/[^0-9.]/g,""),n=n.replace(/(\..*)\./g,"$1");const[o="",s=""]=n.split("."),a=o.slice(0,3),i=s.slice(0,1);n=i!==""||n.includes(".")?`${a}.${i}`:a;const r=parseFloat(n);!isNaN(r)&&r>999.9&&(n="999.9"),t.value=n})})},Ge=async()=>{const e=document.getElementById("login-form");w(e),Ae(e),$(e),Z("input[data-alphanumeric]"),ze("input[data-numeric]"),e&&e.addEventListener("submit",async t=>{if(t.preventDefault(),F(e),!j(e)){console.log("バリデーションエラー： フォーム送信をキャンセル");return}const o=new FormData(e),s=await Be(o),a=document.querySelector(".form-message");s.success?window.location.href=E("/home"):(a.classList.add("error"),a.innerHTML=`ログインに失敗しました。<br>${s.errorMessage}`,a.style.display="block")})},Qe=Object.freeze(Object.defineProperty({__proto__:null,init:Ge},Symbol.toStringTag,{value:"Module"})),re=()=>{document.querySelectorAll(".btn--go-to-step2")&&document.querySelectorAll(".btn--go-to-step2").forEach(n=>{n.addEventListener("click",te)}),document.getElementById("btn--go-to-step2")&&document.getElementById("btn--go-to-step2").addEventListener("click",te),document.getElementById("btn--back-to-step1").addEventListener("click",Ye)},te=()=>{document.getElementById("step1").classList.add("hidden"),document.getElementById("step1").classList.remove("visible"),document.getElementById("step2").classList.add("visible"),document.getElementById("step2").classList.remove("hidden")},Ye=()=>{document.getElementById("step2").classList.add("hidden"),document.getElementById("step2").classList.remove("visible"),document.getElementById("step1").classList.add("visible"),document.getElementById("step1").classList.remove("hidden")},Je=()=>{re();const e=document.querySelectorAll(".notice-contents"),t=document.querySelectorAll(".notice-detail"),n=s=>{t.forEach(a=>{a.classList.toggle("visible",a.id===s),a.classList.toggle("hidden",a.id!==s)})};e.forEach(s=>{s.addEventListener("click",()=>{n(s.dataset.notice)})});const o=document.querySelector("#header__notifications span");o.dataset.icon="notifications"},Xe=Object.freeze(Object.defineProperty({__proto__:null,init:Je},Symbol.toStringTag,{value:"Module"})),Ke=e=>{const t=document.querySelector(".modal-record-admin"),n=document.getElementById("record-form");if($(n),O("input[data-weight-input]"),e){const o=e.date.replace(/-/g,"/");t.querySelector(".date__contents").textContent=o,t.querySelector("#recorded_at").value=o,t.querySelector("#weight").value=e.weight,t.querySelector("#memo").value=e.memo||""}w(n),document.addEventListener("input",w(n)),document.addEventListener("change",w(n)),n&&(n.addEventListener("submit",async s=>{if(s.preventDefault(),F(n),!j(n)){console.log("バリデーションエラー： フォーム送信をキャンセル");return}const i=new FormData(n),r=await Oe(i);window.history.scrollRestoration="manual",window.location.reload(),r.success||alert(r.message)}),document.getElementById("delete-btn").addEventListener("click",async s=>{s.preventDefault();const a=new FormData(n),i=await Fe(a);window.history.scrollRestoration="manual",window.location.reload(),i.success||alert(i.message)}))},Ze=Object.freeze(Object.defineProperty({__proto__:null,init:Ke},Symbol.toStringTag,{value:"Module"})),et=()=>{document.querySelector(".record-reset")&&document.getElementById("reset-btn").addEventListener("click",async n=>{n.preventDefault();const o=await $e();window.history.scrollRestoration="manual",window.location.reload(),o.success||alert(o.message)})},tt=Object.freeze(Object.defineProperty({__proto__:null,init:et},Symbol.toStringTag,{value:"Module"})),ne=e=>{const t=a=>("0"+a).slice(-2),n=e.getFullYear().toString(),o=t(e.getMonth()+1).toString(),s=t(e.getDate()).toString();return`${n}/${o}/${s}`},nt=()=>{const e=document.getElementById("date-contents"),t=document.getElementById("date-prev"),n=document.getElementById("date-next");if(!e)return;const o=new Date,a=new Intl.DateTimeFormat("ja-JP",{timeZone:"Asia/Tokyo",year:"numeric",month:"2-digit",day:"2-digit"}).formatToParts(o),i=a.find(x=>x.type==="year").value,r=a.find(x=>x.type==="month").value,c=a.find(x=>x.type==="day").value,g=new Date(`${i}-${r}-${c}T00:00:00+09:00`);let p=new Date(g);const l=document.getElementById("recorded_at"),D=()=>{e.textContent=ne(p),l.value=ne(p),n.disabled=p.getTime()>=g.getTime()};D(),t.addEventListener("click",()=>{p.setDate(p.getDate()-1),D()}),n.addEventListener("click",()=>{p.getTime()<g.getTime()&&(p.setDate(p.getDate()+1),D())})},ot=async()=>{const e=document.getElementById("record-form");nt(),$(e),O("input[data-weight-input]"),w(e),document.addEventListener("input",w(e)),document.addEventListener("change",w(e)),e&&e.addEventListener("submit",async t=>{if(t.preventDefault(),F(e),!j(e)){console.log("バリデーションエラー： フォーム送信をキャンセル");return}const o=new FormData(e),s=await je(o);window.history.scrollRestoration="manual",window.location.reload(),s.success||alert(s.message)})},st=Object.freeze(Object.defineProperty({__proto__:null,init:ot},Symbol.toStringTag,{value:"Module"})),ce=()=>{const e=document.getElementById("birth-year"),t=document.getElementById("birth-month"),n=document.getElementById("birth-day");if(!e)return;const o=new Date().getFullYear();for(let a=o;a>=o-100;a--){let i=document.createElement("option");i.value=a,i.textContent=a,e.appendChild(i)}const s=()=>{const a=parseInt(e.value,10),i=parseInt(t.value,10);if(t.disabled=!a,n.disabled=!i,!i)return;const r=new Date(a,i,0).getDate();for(;n.options.length>1;)n.remove(1);for(let c=1;c<=r;c++){let g=document.createElement("option");g.value=c,g.textContent=c,n.appendChild(g)}};e.addEventListener("change",s),t.addEventListener("change",s),requestAnimationFrame(()=>{s()})},at=()=>{const e=document.getElementById("register-form");ce(),$(e),w(e),Z("input[data-alphanumeric]"),O("input[data-height-input]"),O("input[data-weight-input]"),re(),e&&e.addEventListener("submit",async t=>{if(t.preventDefault(),F(e),!j(e)){console.log("バリデーションエラー： フォーム送信をキャンセル");return}const o=new FormData(e),s=await Ce(o),a=document.querySelector(".form-message");s.success?(sessionStorage.setItem("accountCreated","true"),window.location.href=E("/home")):(a.classList.add("error"),a.innerHTML=`新規登録に失敗しました。<br>${s.errorMessage}`,a.style.display="block")})},it=Object.freeze(Object.defineProperty({__proto__:null,init:at},Symbol.toStringTag,{value:"Module"})),rt=e=>{const t=document.querySelector("#user-info-form");ce(),$(t),Z("input[data-alphanumeric]"),O("input[data-height-input]"),O("input[data-weight-input]");const n=document.querySelector(".admin-account-form"),o=document.querySelector(".admin-user-form"),s=document.querySelector(".modal");if(e){s.querySelector("#username").value=e.username,s.querySelector("#birth-year").value=e.birth_year,s.querySelector("#birth-month").value=e.birth_month,requestAnimationFrame(()=>{s.querySelector("#birth-day").value=e.birth_day});const a=document.querySelector(`input[name="gender"][value="${e.gender}`);a.checked=!0,s.querySelector("#height").value=e.height,s.querySelector("#ideal-weight").value=e.ideal_weight}w(t),document.addEventListener("input",w(t)),document.addEventListener("change",w(t)),t&&t.addEventListener("submit",async a=>{if(a.preventDefault(),F(t),!j(t)){console.log("バリデーションエラー： フォーム送信をキャンセル");return}const r=new FormData(t);let c;n&&(c=await Ue(r)),o&&(c=await He(r)),window.history.scrollRestoration="manual",window.location.reload(),c.success||alert(c.message)})},ct=Object.freeze(Object.defineProperty({__proto__:null,init:rt},Symbol.toStringTag,{value:"Module"})),lt="visibility",dt="visibility_off",ut="パスワードを表示",mt="パスワードを非表示",gt=()=>{const e=document.querySelectorAll(".pwd-btn");e.length&&e.forEach(t=>{if(t.dataset.inited==="1")return;t.dataset.inited="1",ue(t);const n=()=>ht(t);t.addEventListener("click",n)})},ht=e=>{const t=le(e);t&&(ft(e,!de(e)),ue(e,t))},le=e=>{const t=e.previousElementSibling;return t&&t.tagName.toLowerCase()==="input"?t:null},ft=(e,t)=>e.dataset.hidden=String(t),de=e=>e.dataset.hidden==="true",ue=(e,t=le(e))=>{if(!t)return;const n=de(e);pt(t,n),yt(e,n),vt(e,t,n)},pt=(e,t)=>{e.type=t?"password":"text"},yt=(e,t)=>{const n=e.querySelector("[data-icon]");n&&(n.dataset.icon=t?lt:dt)},vt=(e,t,n)=>{t.id&&e.setAttribute("aria-controls",t.id),e.setAttribute("aria-pressed",String(!n)),e.setAttribute("aria-label",Et(n))},Et=e=>e?ut:mt,me=document.querySelector("body"),bt=document.getElementById("layout");let Q=!1;const Y=new Map,M=new Map,_t=(e,t)=>{const n={record:"./init/record.js",recordAdmin:"./init/record-admin.js",recordReset:"./init/record-reset.js",adminAccount:"./init/user-info.js",adminUser:"./init/user-info.js",login:"./init/login.js",register:"./init/register.js",accountCreated:"./init/account-created.js",accountDelete:"./init/account-delete.js",notifications:"./init/notifications.js"},o=Object.assign({"./init/account-created.js":Te,"./init/account-delete.js":We,"./init/login.js":Qe,"./init/notifications.js":Xe,"./init/record-admin.js":Ze,"./init/record-reset.js":tt,"./init/record.js":st,"./init/register.js":it,"./init/user-info.js":ct}),s=n[e],a=o[s];s&&typeof a.init=="function"&&a.init(t)},oe=async(e,t=null)=>{const n=e;let o=e,s=null;if(e==="recordAdmin"&&t){const i=K(t);if(!i)return;o=`recordAdmin-${i}`,M.has(o)||(s=await ie(t),M.set(o,s))}if(e==="adminUser"&&!M.has(o)&&(s=await Pe(),M.set(o,s)),e==="record"&&xe("/images/date-arrow.svg"),Y.has(n))return;const a=await ae(e);Y.set(n,a)},ee=async(e,t=null)=>{if(Q)return;Q=!0;const n=Y.get(e)||await ae(e),o=t?M.get(t):null;bt.insertAdjacentHTML("afterend",n),me.style.overflow="hidden",gt(),_t(e,o),document.querySelectorAll(".close-modal").forEach(a=>{a&&a.addEventListener("click",ge)}),Q=!1},ge=()=>{const e=document.getElementById("modal");e&&(e.remove(),me.style.overflow="")},he=document.querySelectorAll("[data-modal]");he.forEach(e=>{e.addEventListener("click",async()=>{const t=e.getAttribute("data-modal");let n=t;if(t==="recordAdmin"){const o=K(e);o&&(n=`recordAdmin-${o}`)}if(!M.has(n)){const o=await ie(e);M.set(n,o)}ee(t,n)})});document.addEventListener("click",e=>{const t=document.querySelector("#modal.record, #modal.recordAdmin");t&&e.target===t&&ge()});const fe=new Set;he.forEach(e=>{const t=e.getAttribute("data-modal");fe.add(t)});const wt=document.querySelectorAll('[data-modal="recordAdmin"]');window.addEventListener("load",()=>{setTimeout(async()=>{const e=[...fe].map(t=>oe(t));await Promise.all(e);for(const t of wt)await oe("recordAdmin",t)},1e3)});sessionStorage.getItem("accountCreated")==="true"&&(ee("accountCreated"),sessionStorage.removeItem("accountCreated"));showIdModal&&ee("idCheck");const St=()=>{const e=document.getElementById("header");if(!e)return;const t=e.offsetHeight;let n=0;window.addEventListener("load",()=>{window.addEventListener("scroll",()=>{const r=window.scrollY||document.documentElement.scrollTop;r>n&&r>t?e.style.top=`-${t}px`:e.style.top="0",n=r})});const o=document.getElementById("menu-toggle"),s=document.querySelector(".layout__sidebar");o.addEventListener("click",()=>{s.classList.contains("open")?(s.classList.remove("open"),s.classList.add("close")):(s.classList.remove("close"),s.classList.add("open"))});const a=window.matchMedia("(max-width: 1299px)"),i=r=>{r.matches?(s.classList.remove("open"),s.classList.add("close")):(s.classList.remove("close"),s.classList.add("open"))};i(a),a.addEventListener("change",i),document.addEventListener("click",r=>{r.target.closest(".layout__sidebar")||a.matches&&(s.classList.remove("open"),s.classList.add("close"))})},Lt=()=>{const e=document.querySelectorAll(".accordion-btn");e.length&&e.forEach((t,n)=>{Dt(t,n),t.addEventListener("click",()=>kt(t))})},Dt=(e,t)=>{const n=e.closest(".accordion"),o=n==null?void 0:n.querySelector(".accordion-content");if(!n||!o)return;const s=`accordion-btn-${t+1}`,a=`accordion-panel-${t+1}`;e.id=s,e.setAttribute("aria-controls",a),e.setAttribute("aria-expanded","false"),o.id=a,o.setAttribute("role","region"),o.setAttribute("aria-labelledby",s),o.hidden=!0,o.style.maxHeight="0",n.setAttribute("data-state","close")},kt=e=>{const t=e.closest(".accordion"),n=t==null?void 0:t.querySelector(".accordion-content");if(!t||!n)return;t.getAttribute("data-state")==="open"?It(t,e,n):At(t,e,n)},At=(e,t,n)=>{n.hidden=!1,n.style.maxHeight="0",requestAnimationFrame(()=>{n.style.maxHeight=n.scrollHeight+"px"}),t.setAttribute("aria-expanded","true"),e.setAttribute("data-state","open")},It=(e,t,n)=>{n.style.maxHeight=n.scrollHeight+"px",requestAnimationFrame(()=>{n.style.maxHeight="0"});const o=s=>{s.propertyName==="max-height"&&(n.hidden=!0,n.removeEventListener("transitionend",o))};n.addEventListener("transitionend",o),t.setAttribute("aria-expanded","false"),e.setAttribute("data-state","close")},qt=()=>{const e=document.getElementById("header__info"),t=document.getElementById("header__profile"),n=document.getElementById("user-popup");!e||!t||!n||(Tt(t,n),t.addEventListener("click",o=>{o.stopPropagation(),xt(e,t)}),document.addEventListener("click",o=>{n.contains(o.target)||pe(e,t)}))},Tt=(e,t)=>{e.setAttribute("aria-controls",t.id),e.setAttribute("aria-expanded","false")},xt=(e,t)=>{e.classList.contains("click")?pe(e,t):Mt(e,t)},Mt=(e,t)=>{e.classList.add("click"),t.setAttribute("aria-expanded","true")},pe=(e,t)=>{e.classList.remove("click"),t.setAttribute("aria-expanded","false")},Bt="IDをコピーしました。",J="copy-dialog",Ct=10,Rt=1500,Ot=2e3,jt=(e=document,{message:t=Bt}={})=>{const n=async o=>{const s=o.target.closest(".copy-link");if(!s)return;const a=s.closest(".copy-contents"),i=a==null?void 0:a.querySelector(".copy__value");if(i&&!document.querySelector(`.${J}`))try{await navigator.clipboard.writeText(i.textContent),Ft(t)}catch{}};e.addEventListener("click",n)},Ft=e=>{const t=$t();Pt(t,e)},$t=()=>{let e=document.querySelector(`.${J}`);return e||(e=document.createElement("div"),e.classList.add(J),e.setAttribute("role","status"),e.setAttribute("aria-live","polite"),e.setAttribute("aria-atomic","true"),document.body.appendChild(e)),e},Pt=(e,t)=>{e.textContent=t,setTimeout(()=>e.classList.add("show"),Ct),setTimeout(()=>e.classList.remove("show"),Rt),setTimeout(()=>e.remove(),Ot)},Ht=()=>{const e=document.querySelector(".weight-days__blocks"),t=document.querySelectorAll(".weight-days__block");if(!e)return;const n=c=>[...t].sort((g,p)=>{const l=g.querySelector(".weight-days__date").textContent,D=p.querySelector(".weight-days__date").textContent;return c?l<D?-1:1:l>D?-1:1});let o=!1;e.innerHTML="",n(o).forEach(c=>e.appendChild(c));const s=document.querySelector(".weight-days .btn--more");let a=6;const i=c=>{c.forEach((g,p)=>{p<a?g.classList.add("show"):g.classList.contains("show")&&g.classList.remove("show")}),a>=c.length&&s.classList.add("hide")};i(n(o)),s.addEventListener("click",()=>{a+=6,i(n(o))}),document.querySelectorAll(".weight-days__switch button").forEach(c=>{c.addEventListener("click",()=>{var g;(g=document.querySelector(".weight-days__switch .btn--select"))==null||g.classList.remove("btn--select"),c.classList.add("btn--select"),o?o=!1:o=!0,e.innerHTML="",n(o).forEach(p=>e.appendChild(p)),i(n(o))})})},Ut=async()=>{const e=document.getElementById("graph");if(!e)return;const t=await Re(),n=t.chart_arr,o=t.ideal_weight;Chart.register(window["chartjs-plugin-annotation"]);const s=(d,h=!1)=>{const m=new Date;m.setHours(0,0,0,0);let S=new Date(m.setDate(m.getDate()+1)),L=new Date(m);const _={"7d":[7,14],"1m":[1,2],"3m":[3,6],"6m":[6,12],"1y":[12,24]};d==="7d"?(S.setDate(m.getDate()-(h?_[d][1]:_[d][0])),h&&L.setDate(m.getDate()-_[d][0])):(S.setMonth(m.getMonth()-(h?_[d][1]:_[d][0])),h&&L.setMonth(m.getMonth()-_[d][0]));let y=[],v=new Date(S);for(;v<L;)y.push(new Date(v.getTime()-v.getTimezoneOffset()*6e4).toISOString().split("T")[0]),v.setDate(v.getDate()+1);return y},a=(d,h=!1)=>{const m=s(d,h),S=Object.fromEntries(n.map(f=>[f.date,f.weight])),L=Object.fromEntries(n.map(f=>[f.date,f.bmi])),_=Object.fromEntries(n.map(f=>[f.date,f.bfp])),y=m.map(f=>S[f]??null),v=m.map(f=>L[f]??null),I=m.map(f=>_[f]??null);return{labels:m,dataset:y,bmi:v,bfp:I}},i=window.matchMedia("(max-width: 599px)");let r;const c=d=>{const{labels:h,dataset:m}=a(d),S=h.map(y=>y.replaceAll("-","/")),L=e.getContext("2d");r&&r.destroy(),r=new Chart(L,{type:"line",data:{labels:S,datasets:[{label:"体重（kg）",data:m,backgroundColor:"#4a90e2",borderColor:"#4a90e2",borderWidth:2,pointRadius:4,pointBackgroundColor:"#fff",pointBorderColor:"#4a90e2",pointBorderWidth:3,hoverBorderWidth:4,pointHoverRadius:6,spanGaps:!0}]},options:{responsive:!0,maintainAspectRatio:!0,aspectRatio:i.matches?4/3:2/1,scales:{x:{ticks:{autoSkip:!0,callback(y){return h[y]?`${new Date(h[y]).getDate()}日`:""},maxRotation:0,minRotation:0,maxTicksLimit:15}},y:{suggestedMax:Math.max(...m)+1,suggestedMin:o-1,ticks:{maxTicksLimit:i.matches?6:8}}},plugins:{legend:{display:!1},tooltip:{titleFont:{size:i.matches?10:12,family:"Inter, Noto Sans JP, sans-serif"},bodyFont:{size:i.matches?12:14,family:"Inter, Noto Sans JP, sans-serif"},callbacks:{label(y){return` 体重: ${y.raw} kg`}}},annotation:{annotations:{goalLine:{type:"line",yMin:o,yMax:o,borderColor:"#e65100",borderWidth:2,borderDash:[6,6],label:{content:"目標体重",enabled:!0,position:"end"}}}}}}});const _=y=>{const v=y,I=Math.ceil(h.length/v);let f=0;r.data.datasets[0].data=m.map((P,R,q)=>{const u=q.length-1,k=u-R;if(R===u||k%I===0){let V=m.slice(f,R+1).filter(z=>z),A=V.reduce((z,ye)=>parseFloat(z)+parseFloat(ye),0);if(!A)return null;let W=(A/V.length).toFixed(1);return f=R+1,W}else return null})};if(i.matches?(_(12),r.update()):(_(31),r.update()),d==="3m"||d==="6m"||d==="1y"){let y=null;r.options.scales.x.ticks.callback=v=>{let I=new Date(h[v]),f=I.getMonth()+1,P=I.getDate();if(!(f===y||P!==1))return y=f,`${f}月`},r.update()}},g=d=>{const h=s(d).map(L=>L.replaceAll("-","/")),m=h[0],S=h[h.length-1];return`${m}～${S}`},p=document.querySelector(".weight-graph__date");let l="1m";c(l),p.innerHTML=g(l),i.addEventListener("change",()=>c(l));const D=document.querySelectorAll(".weight-graph__switch button"),x=document.querySelectorAll(".weight-summary__block");if(D.length<1)return;D.forEach(d=>{d.addEventListener("click",()=>{var h;(h=document.querySelector(".weight-graph__switch .btn--select"))==null||h.classList.remove("btn--select"),d.classList.add("btn--select")})});const C=d=>{const h=a(d),m=h.dataset.filter(u=>u!==null),S=h.bmi.filter(u=>u!==null),L=h.bfp.filter(u=>u!==null),y=a(d,!0).dataset.filter(u=>u!==null),v=(u,k=1)=>{const T=u.filter(A=>A!=null).map(A=>parseFloat(A.replace(/,/g,"")));return T.length?(T.reduce((A,W)=>A+W,0)/T.length).toFixed(k):null},I=(u,k)=>{if(u.length&&k.length){const T=(v(u)-v(k)).toFixed(1);return T>0?"+"+T:String(T)}else return null},f=u=>u.length?Math.max(...u).toFixed(1):null,P=u=>u.length?Math.min(...u).toFixed(1):null,R={average:v(m),bfp:v(L,2),bmi:v(S,2),in_de:I(m,y),best:f(m),lowest:P(m)};let q;d==="7d"&&(q="1週間"),d==="1m"&&(q="1ヶ月"),d==="3m"&&(q="3ヶ月"),d==="6m"&&(q="半年"),d==="1y"&&(q="1年"),x.forEach(u=>{u.querySelector(".period").innerHTML=q;const k=R[u.dataset.summary];k?u.querySelector(".weight-summary__num").innerHTML=k:u.querySelector(".weight-summary__num").innerHTML="--"})};C(l),document.getElementById("weight-graph__week").addEventListener("click",()=>{l="7d",c(l),p.innerHTML=g(l),C(l)}),document.getElementById("weight-graph__month").addEventListener("click",()=>{l="1m",c(l),p.innerHTML=g(l),C(l)}),document.getElementById("weight-graph__three-month").addEventListener("click",()=>{l="3m",c(l),p.innerHTML=g(l),C(l)}),document.getElementById("weight-graph__half-year").addEventListener("click",()=>{l="6m",c(l),p.innerHTML=g(l),C(l)}),document.getElementById("weight-graph__year").addEventListener("click",()=>{l="1y",c(l),p.innerHTML=g(l),C(l)})};document.querySelector("#header")&&St();document.querySelector(".accordion")&&Lt();document.querySelector("#header__info")&&qt();jt();document.querySelector(".weight-days__blocks")&&Ht();document.querySelector("#graph")&&Ut();
